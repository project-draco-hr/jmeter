{
  GuiPackage gui=GuiPackage.getInstance();
  engine=new StandardJMeterEngine();
  HashTree testTree=gui.getTreeModel().getTestPlan();
  convertSubTree(testTree);
  DisabledComponentRemover remover=new DisabledComponentRemover(testTree);
  testTree.traverse(remover);
  testTree.add(testTree.getArray()[0],gui.getMainFrame());
  log.debug("test plan before cloning is running version: " + ((TestPlan)testTree.getArray()[0]).isRunningVersion());
  TreeCloner cloner=new TreeCloner(false);
  testTree.traverse(cloner);
  engine.configure(cloner.getClonedTree());
  try {
    engine.runTest();
  }
 catch (  JMeterEngineException e) {
    JOptionPane.showMessageDialog(gui.getMainFrame(),e.getMessage(),JMeterUtils.getResString("Error Occurred"),JOptionPane.ERROR_MESSAGE);
  }
  log.debug("test plan after cloning and running test is running version: " + ((TestPlan)testTree.getArray()[0]).isRunningVersion());
}
