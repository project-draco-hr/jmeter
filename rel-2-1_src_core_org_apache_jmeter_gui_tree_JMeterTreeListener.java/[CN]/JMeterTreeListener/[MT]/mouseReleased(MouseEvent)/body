{
  if (dragging && isValidDragAction(draggedNodes,getCurrentNode())) {
    dragging=false;
    JPopupMenu dragNdrop=new JPopupMenu();
    JMenuItem item=new JMenuItem(JMeterUtils.getResString("Insert Before"));
    item.addActionListener(actionHandler);
    item.setActionCommand(ActionNames.INSERT_BEFORE);
    dragNdrop.add(item);
    item=new JMenuItem(JMeterUtils.getResString("Insert After"));
    item.addActionListener(actionHandler);
    item.setActionCommand(ActionNames.INSERT_AFTER);
    dragNdrop.add(item);
    item=new JMenuItem(JMeterUtils.getResString("Add as Child"));
    item.addActionListener(actionHandler);
    item.setActionCommand(ActionNames.DRAG_ADD);
    dragNdrop.add(item);
    dragNdrop.addSeparator();
    item=new JMenuItem(JMeterUtils.getResString("Cancel"));
    dragNdrop.add(item);
    displayPopUp(e,dragNdrop);
  }
 else {
    GuiPackage.getInstance().getMainFrame().repaint();
  }
  dragging=false;
}
