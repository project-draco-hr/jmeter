{
synchronized (sampleStore) {
    String key=StatisticalSampleResult.getKey(e);
    StatisticalSampleResult statResult=(StatisticalSampleResult)sampleTable.get(key);
    if (statResult == null) {
      statResult=new StatisticalSampleResult(e.getResult());
      sampleTable.put(key,statResult);
      sampleStore.add(new SampleEvent(statResult,e.getThreadGroup()));
    }
    statResult.add(e.getResult());
    sampleCount++;
    if (numSamplesThreshold != -1) {
      if (sampleCount >= numSamplesThreshold) {
        try {
          if (log.isDebugEnabled()) {
            log.debug("Firing sample");
          }
          sendBatch();
        }
 catch (        RemoteException err) {
          log.warn("sampleOccurred",err);
        }
      }
    }
    if (timeThreshold != -1) {
      long now=System.currentTimeMillis();
      if (batchSendTime == -1) {
        this.batchSendTime=now + timeThreshold;
      }
      if (batchSendTime < now) {
        try {
          if (log.isDebugEnabled()) {
            log.debug("Firing time");
          }
          sendBatch();
          this.batchSendTime=now + timeThreshold;
        }
 catch (        RemoteException err) {
          log.warn("sampleOccurred",err);
        }
      }
    }
  }
}
