{
  expected=removeEscapeCharacters(expected);
  actual=removeEscapeCharacters(actual);
  Parser expectedParser=Parser.createParser(expected);
  Parser resultParser=Parser.createParser(actual);
  NodeIterator expectedIterator=expectedParser.elements();
  NodeIterator actualIterator=resultParser.elements();
  displayMessage=createGenericFailureMessage(displayMessage,expected,actual);
  Node nextExpectedNode=null, nextActualNode=null;
  do {
    nextExpectedNode=getNextNodeUsing(expectedIterator);
    nextActualNode=getNextNodeUsing(actualIterator);
    assertStringValueMatches(displayMessage,nextExpectedNode,nextActualNode);
    fixIfXmlEndTag(resultParser,nextActualNode);
    fixIfXmlEndTag(expectedParser,nextExpectedNode);
    assertSameType(displayMessage,nextExpectedNode,nextActualNode);
    assertTagEquals(displayMessage,nextExpectedNode,nextActualNode);
  }
 while (expectedIterator.hasMoreNodes());
  assertActualXmlHasNoMoreNodes(displayMessage,actualIterator);
}
