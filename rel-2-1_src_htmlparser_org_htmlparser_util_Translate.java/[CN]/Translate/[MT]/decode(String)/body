{
  int index;
  int length;
  int amp;
  int semi;
  String code;
  char character;
  StringBuffer ret;
  ret=new StringBuffer(string.length());
  index=0;
  length=string.length();
  while ((index < length) && (-1 != (amp=string.indexOf('&',index)))) {
    ret.append(string.substring(index,amp));
    index=amp + 1;
    if (amp < length - 1) {
      semi=string.indexOf(';',amp);
      if (-1 != semi)       code=string.substring(amp,semi + 1);
 else       code=string.substring(amp);
      if (0 != (character=convertToChar(code)))       index+=code.length() - 1;
 else       character='&';
    }
 else     character='&';
    ret.append(character);
  }
  if (index < length)   ret.append(string.substring(index));
  return (ret.toString());
}
