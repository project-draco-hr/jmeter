{
  AssertionResult result=new AssertionResult(getName());
  byte[] responseData=response.getResponseData();
  if (responseData.length == 0) {
    return result.setResultForNull();
  }
  result.setFailure(false);
  result.setFailureMessage("");
  if (log.isDebugEnabled()) {
    log.debug(new StringBuilder("Validation is set to ").append(isValidating()).toString());
    log.debug(new StringBuilder("Whitespace is set to ").append(isWhitespace()).toString());
    log.debug(new StringBuilder("Tolerant is set to ").append(isTolerant()).toString());
  }
  Document doc=null;
  boolean isXML=JOrphanUtils.isXML(responseData);
  try {
    doc=XPathUtil.makeDocument(new ByteArrayInputStream(responseData),isValidating(),isWhitespace(),isNamespace(),isTolerant(),isQuiet(),showWarnings(),reportErrors(),isXML,isDownloadDTDs());
  }
 catch (  SAXException e) {
    log.debug("Caught sax exception: " + e);
    result.setError(true);
    result.setFailureMessage(new StringBuilder("SAXException: ").append(e.getMessage()).toString());
    return result;
  }
catch (  IOException e) {
    log.warn("Cannot parse result content",e);
    result.setError(true);
    result.setFailureMessage(new StringBuilder("IOException: ").append(e.getMessage()).toString());
    return result;
  }
catch (  ParserConfigurationException e) {
    log.warn("Cannot parse result content",e);
    result.setError(true);
    result.setFailureMessage(new StringBuilder("ParserConfigurationException: ").append(e.getMessage()).toString());
    return result;
  }
catch (  TidyException e) {
    result.setError(true);
    result.setFailureMessage(e.getMessage());
    return result;
  }
  if (doc == null || doc.getDocumentElement() == null) {
    result.setError(true);
    result.setFailureMessage("Document is null, probably not parsable");
    return result;
  }
  XPathUtil.computeAssertionResult(result,doc,getXPathString(),isNegated());
  return result;
}
