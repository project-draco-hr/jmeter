{
  String val=null;
  XObject xObject=XPathAPI.eval(d,query);
  if (xObject.getType() == XObject.CLASS_NODESET) {
    NodeList matches=xObject.nodelist();
    int length=matches.getLength();
    vars.put(concat(refName,MATCH_NR),String.valueOf(length));
    for (int i=0; i < length; i++) {
      Node match=matches.item(i);
      if (match instanceof Element) {
        val=match.getFirstChild().getNodeValue();
      }
 else {
        val=match.getNodeValue();
      }
      if (val != null) {
        if (i == 0) {
          vars.put(refName,val);
        }
        vars.put(concat(refName,String.valueOf(i + 1)),val);
      }
    }
    vars.remove(concat(refName,String.valueOf(length + 1)));
  }
 else {
    val=xObject.toString();
    vars.put(concat(refName,MATCH_NR),"1");
    vars.put(refName,val);
    vars.put(concat(refName,"1"),val);
    vars.remove(concat(refName,"2"));
  }
}
