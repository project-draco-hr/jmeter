{
  JMeterContext context=getThreadContext();
  final SampleResult previousResult=context.getPreviousResult();
  if (previousResult == null) {
    return;
  }
  JMeterVariables vars=context.getVariables();
  String refName=getRefName();
  vars.put(refName,getDefaultValue());
  vars.put(concat(refName,MATCH_NR),"0");
  vars.remove(concat(refName,"1"));
  try {
    Document d=parseResponse(previousResult);
    getValuesForXPath(d,getXPathQuery(),vars,refName);
  }
 catch (  IOException e) {
    final String errorMessage="IOException on (" + getXPathQuery() + ")";
    log.error(errorMessage,e);
    AssertionResult ass=new AssertionResult(getName());
    ass.setError(true);
    ass.setFailureMessage(new StringBuilder("IOException: ").append(e.getLocalizedMessage()).toString());
    previousResult.addAssertionResult(ass);
    previousResult.setSuccessful(false);
  }
catch (  ParserConfigurationException e) {
    final String errrorMessage="ParserConfigurationException while processing (" + getXPathQuery() + ")";
    log.error(errrorMessage,e);
    throw new JMeterError(errrorMessage,e);
  }
catch (  SAXException e) {
    log.warn("SAXException while processing (" + getXPathQuery() + ") "+ e.getLocalizedMessage());
    addAssertionFailure(previousResult,e,false);
  }
catch (  TransformerException e) {
    log.warn("TransformerException while processing (" + getXPathQuery() + ") "+ e.getLocalizedMessage());
    addAssertionFailure(previousResult,e,false);
  }
catch (  TidyException e) {
    addAssertionFailure(previousResult,e,true);
  }
}
