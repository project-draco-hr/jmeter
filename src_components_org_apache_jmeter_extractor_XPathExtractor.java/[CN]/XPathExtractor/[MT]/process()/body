{
  JMeterContext context=getThreadContext();
  JMeterVariables vars=context.getVariables();
  String refName=getRefName();
  vars.put(refName,getDefaultValue());
  vars.put(concat(refName,MATCH_NR),"0");
  vars.remove(concat(refName,"1"));
  final SampleResult previousResult=context.getPreviousResult();
  try {
    Document d=parseResponse(previousResult);
    getValuesForXPath(d,getXPathQuery(),vars,refName);
  }
 catch (  IOException e) {
    final String errorMessage="IOException on (" + getXPathQuery() + ")";
    log.error(errorMessage,e);
    AssertionResult ass=new AssertionResult("IOException");
    ass.setFailure(true);
    ass.setFailureMessage(e.getLocalizedMessage());
    previousResult.addAssertionResult(ass);
    previousResult.setSuccessful(false);
  }
catch (  ParserConfigurationException e) {
    final String errrorMessage="error on (" + getXPathQuery() + ")";
    log.error(errrorMessage,e);
    throw new JMeterError(errrorMessage,e);
  }
catch (  SAXException e) {
    log.warn("error on (" + getXPathQuery() + ")"+ e.getLocalizedMessage());
  }
catch (  TransformerException e) {
    log.warn("error on (" + getXPathQuery() + ")"+ e.getLocalizedMessage());
  }
catch (  TidyException e) {
    AssertionResult ass=new AssertionResult("TidyException");
    ass.setFailure(true);
    ass.setFailureMessage(e.getLocalizedMessage());
    previousResult.addAssertionResult(ass);
    previousResult.setSuccessful(false);
  }
}
