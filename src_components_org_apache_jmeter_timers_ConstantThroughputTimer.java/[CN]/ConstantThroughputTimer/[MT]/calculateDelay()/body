{
  long delay=0;
  double msPerRequest=(MILLISEC_PER_MIN / getThroughput());
switch (modeInt) {
case 1:
    delay=(long)(JMeterContextService.getNumberOfThreads() * msPerRequest);
  break;
case 2:
delay=(long)(JMeterContextService.getContext().getThreadGroup().getNumberOfThreads() * msPerRequest);
break;
case 3:
delay=calculateSharedDelay(allThreadsInfo,(long)msPerRequest);
break;
case 4:
final org.apache.jmeter.threads.AbstractThreadGroup group=JMeterContextService.getContext().getThreadGroup();
ThroughputInfo groupInfo;
synchronized (threadGroupsInfoMap) {
groupInfo=threadGroupsInfoMap.get(group);
if (groupInfo == null) {
groupInfo=new ThroughputInfo();
threadGroupsInfoMap.put(group,groupInfo);
}
}
delay=calculateSharedDelay(groupInfo,(long)msPerRequest);
break;
default :
delay=(long)msPerRequest;
break;
}
return delay;
}
