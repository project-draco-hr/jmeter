{
  prepare();
  long currentTime=System.currentTimeMillis();
  long currentTarget=targetTime == 0 ? currentTime : targetTime;
  targetTime=currentTarget + (long)(60000.0 / getThroughput());
  if (currentTime > currentTarget) {
    return 0;
  }
  return currentTarget - currentTime;
}
