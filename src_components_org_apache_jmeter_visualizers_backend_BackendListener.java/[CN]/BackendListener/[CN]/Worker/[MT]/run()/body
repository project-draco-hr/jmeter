{
  boolean isDebugEnabled=LOGGER.isDebugEnabled();
  List<SampleResult> sampleResults=new ArrayList<SampleResult>(queue.size());
  try {
    boolean endOfLoop=false;
    while (!endOfLoop) {
      if (isDebugEnabled) {
        LOGGER.debug("Thread:" + Thread.currentThread().getName() + " taking SampleResult from queue:"+ queue.size());
      }
      SampleResult e=queue.take();
      if (isDebugEnabled) {
        LOGGER.debug("Thread:" + Thread.currentThread().getName() + " took SampleResult:"+ e+ ", isFinal:"+ (e == FINAL_EVENT));
      }
      while (!(endOfLoop=(e == FINAL_EVENT)) && e != null) {
        sampleResults.add(e);
        if (isDebugEnabled) {
          LOGGER.debug("Thread:" + Thread.currentThread().getName() + " polling from queue:"+ queue.size());
        }
        e=queue.poll();
        if (isDebugEnabled) {
          LOGGER.debug("Thread:" + Thread.currentThread().getName() + " took from queue:"+ e+ ", isFinal:"+ (e == FINAL_EVENT));
        }
      }
      if (isDebugEnabled) {
        LOGGER.debug("Thread:" + Thread.currentThread().getName() + " exiting with FINAL EVENT:"+ (e == FINAL_EVENT)+ ", null:"+ (e == null));
      }
      int size=sampleResults.size();
      if (size > 0) {
        backendListenerClient.handleSampleResults(sampleResults,context);
        sampleResults.clear();
      }
      if (!endOfLoop) {
        LockSupport.parkNanos(100);
      }
    }
  }
 catch (  InterruptedException e) {
  }
  int size=sampleResults.size();
  if (size > 0) {
    backendListenerClient.handleSampleResults(sampleResults,context);
    sampleResults.clear();
  }
  LOGGER.info("Worker ended");
}
