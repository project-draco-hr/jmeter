{
  String graphiteMetricsSenderClass=context.getParameter("graphiteMetricsSender");
  graphiteHost=context.getParameter("graphiteHost");
  graphitePort=context.getIntParameter("graphitePort",DEFAULT_PLAINTEXT_PROTOCOL_PORT);
  summaryOnly=context.getBooleanParameter("summaryOnly",true);
  samplersList=context.getParameter("samplersList","");
  rootMetricsPrefix=context.getParameter("rootMetricsPrefix",DEFAULT_METRICS_PREFIX);
  String percentilesAsString=context.getParameter("percentiles",DEFAULT_METRICS_PREFIX);
  String[] percentilesStringArray=percentilesAsString.split(SEPARATOR);
  okPercentiles=new HashMap<>(percentilesStringArray.length);
  koPercentiles=new HashMap<>(percentilesStringArray.length);
  allPercentiles=new HashMap<>(percentilesStringArray.length);
  DecimalFormat format=new DecimalFormat("0.##");
  for (int i=0; i < percentilesStringArray.length; i++) {
    if (!StringUtils.isEmpty(percentilesStringArray[i].trim())) {
      try {
        Float percentileValue=Float.parseFloat(percentilesStringArray[i].trim());
        okPercentiles.put(METRIC_OK_PERCENTILE_PREFIX + AbstractGraphiteMetricsSender.sanitizeString(format.format(percentileValue)),percentileValue);
        koPercentiles.put(METRIC_KO_PERCENTILE_PREFIX + AbstractGraphiteMetricsSender.sanitizeString(format.format(percentileValue)),percentileValue);
        allPercentiles.put(METRIC_ALL_PERCENTILE_PREFIX + AbstractGraphiteMetricsSender.sanitizeString(format.format(percentileValue)),percentileValue);
      }
 catch (      Exception e) {
        LOGGER.error("Error parsing percentile:'" + percentilesStringArray[i] + "'",e);
      }
    }
  }
  Class<?> clazz=Class.forName(graphiteMetricsSenderClass);
  this.graphiteMetricsManager=(GraphiteMetricsSender)clazz.newInstance();
  graphiteMetricsManager.setup(graphiteHost,graphitePort,rootMetricsPrefix);
  String[] samplers=samplersList.split(SEPARATOR);
  samplersToFilter=new HashSet<>();
  for (  String samplerName : samplers) {
    samplersToFilter.add(samplerName);
  }
  scheduler=Executors.newScheduledThreadPool(MAX_POOL_SIZE);
  this.timerHandle=scheduler.scheduleAtFixedRate(this,ONE_SECOND,ONE_SECOND,TimeUnit.SECONDS);
}
