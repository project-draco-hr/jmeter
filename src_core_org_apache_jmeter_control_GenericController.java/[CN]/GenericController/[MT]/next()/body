{
  TestElement controller=getCurrentController();
  fireIterEvents(controller);
  if (controller == null) {
    nextAtEnd();
    if (subControllersAndSamplers.size() > 0)     return next();
 else     return null;
  }
  if (controller instanceof Sampler) {
    incrementCurrent();
    samplersReturned++;
    return (Sampler)controller;
  }
 else {
    Controller c=(Controller)controller;
    if (c.hasNext()) {
      Sampler s=c.next();
      return s;
    }
 else     if (c.isDone()) {
      removeCurrentController();
      return next();
    }
 else {
      incrementCurrent();
      return next();
    }
  }
}
