{
  if (isFirst()) {
    calls=0;
    noFailingSamples=0;
    res=new SampleResult();
    res.setSampleLabel(getName());
    res.setSuccessful(true);
    res.sampleStart();
    prevEndTime=res.getStartTime();
    pauseTime=0;
  }
  boolean isLast=current == super.subControllersAndSamplers.size();
  Sampler returnValue=super.next();
  if (returnValue == null && isLast) {
    if (res != null) {
      res.setIdleTime(pauseTime + res.getIdleTime());
      res.sampleEnd();
      res.setResponseMessage("Number of samples in transaction : " + calls + ", number of failing samples : "+ noFailingSamples);
      if (res.isSuccessful()) {
        res.setResponseCodeOK();
      }
      JMeterContext threadContext=getThreadContext();
      JMeterVariables threadVars=threadContext.getVariables();
      SamplePackage pack=(SamplePackage)threadVars.getObject(JMeterThread.PACKAGE_OBJECT);
      if (pack == null) {
        log.warn("Could not fetch SamplePackage");
      }
 else {
        SampleEvent event=new SampleEvent(res,threadContext.getThreadGroup().getName(),threadVars,true);
        res=null;
        if (!getThreadContext().isReinitializingSubControllers()) {
          lnf.notifyListeners(event,pack.getSampleListeners());
        }
      }
    }
  }
 else {
    calls++;
  }
  return returnValue;
}
