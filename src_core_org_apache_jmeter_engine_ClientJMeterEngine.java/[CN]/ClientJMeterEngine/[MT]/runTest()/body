{
  log.info("running clientengine run method");
  SearchByClass<TestListener> testListeners=new SearchByClass<TestListener>(TestListener.class);
  ConvertListeners sampleListeners=new ConvertListeners();
  HashTree testTree=test;
  PreCompiler compiler=new PreCompiler(true);
synchronized (testTree) {
    testTree.traverse(compiler);
    testTree.traverse(new TurnElementsOn());
    testTree.traverse(testListeners);
    testTree.traverse(sampleListeners);
  }
  String methodName="unknown";
  try {
    JMeterContextService.startTest();
    File baseDirRelative=FileServer.getFileServer().getBaseDirRelative();
    String scriptName=FileServer.getFileServer().getScriptName();
synchronized (LOCK) {
      methodName="rconfigure()";
      remote.rconfigure(testTree,host,baseDirRelative,scriptName);
    }
    log.info("sent test to " + host + " basedir='"+ baseDirRelative+ "'");
    if (savep == null) {
      savep=new Properties();
    }
    log.info("Sending properties " + savep);
    try {
      methodName="rsetProperties()";
      remote.rsetProperties(savep);
    }
 catch (    RemoteException e) {
      log.warn("Could not set properties: " + e.toString());
    }
    methodName="rrunTest()";
    remote.rrunTest();
    log.info("sent run command to " + host);
  }
 catch (  IllegalStateException ex) {
    log.error("Error in " + methodName + " method "+ ex);
    tidyRMI(log);
    throw ex;
  }
catch (  Exception ex) {
    log.error("Error in " + methodName + " method "+ ex);
    tidyRMI(log);
    throw new JMeterEngineException("Error in " + methodName + " method "+ ex,ex);
  }
}
