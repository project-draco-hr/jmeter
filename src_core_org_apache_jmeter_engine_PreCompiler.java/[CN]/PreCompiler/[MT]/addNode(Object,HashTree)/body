{
  if (node instanceof TestPlan) {
    Map args=((TestPlan)node).getUserDefinedVariables();
    replacer.setUserDefinedVariables(args);
    JMeterVariables vars=new JMeterVariables();
    vars.putAll(args);
    JMeterContextService.getContext().setVariables(vars);
  }
 else   if (node instanceof TestElement) {
    try {
      replacer.replaceValues((TestElement)node);
      ((TestElement)node).setRunningVersion(true);
    }
 catch (    InvalidVariableException e) {
      log.error("invalid variables",e);
    }
  }
  if (node instanceof Arguments) {
    Map args=((Arguments)node).getArgumentsAsMap();
    for (Iterator a=args.entrySet().iterator(); a.hasNext(); ) {
      Map.Entry e=(Map.Entry)a.next();
      replacer.addVariable((String)e.getKey(),(String)e.getValue());
    }
    JMeterContextService.getContext().getVariables().putAll(args);
  }
}
