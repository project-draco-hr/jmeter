{
  running=false;
  engine=null;
  if (now) {
    tellThreadsToStop();
    pause(10 * allThreads.size());
    boolean stopped=verifyThreadsStopped();
    if (!stopped) {
      notifyTestListenersOfEnd(testListenersSave);
      if (JMeter.isNonGUI()) {
        exit();
      }
 else {
        JMeterUtils.reportErrorToUser(JMeterUtils.getResString("stopping_test_failed"),JMeterUtils.getResString("stopping_test_title"));
      }
    }
  }
 else {
    stopAllThreads();
    if (serialized) {
      notifyTestListenersOfEnd(testListenersSave);
    }
  }
}
