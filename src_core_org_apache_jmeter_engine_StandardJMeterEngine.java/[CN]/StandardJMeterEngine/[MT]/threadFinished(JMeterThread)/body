{
  try {
    allThreads.remove(thread);
    log.info("Ending thread " + thread.getThreadName());
    if (!startingGroups && allThreads.size() == 0) {
      log.info("Stopping test");
      stopTest();
    }
  }
 catch (  Throwable e) {
    log.fatalError("Call to threadFinished should never throw an exception - this can deadlock JMeter",e);
  }
}
