{
  Map newMap=null;
  try {
    newMap=(Map)prop.getObjectValue().getClass().newInstance();
  }
 catch (  Exception e) {
    log.error("",e);
    return;
  }
  PropertyIterator iter=prop.valueIterator();
  while (iter.hasNext()) {
    JMeterProperty val=iter.next();
    if (val instanceof TestElementProperty) {
      undoReverseReplace((TestElement)val.getObjectValue());
    }
 else     if (val instanceof StringProperty) {
      val=substituteReferences((StringProperty)val);
    }
 else     if (val instanceof CollectionProperty) {
      undoReverseReplace((CollectionProperty)val);
    }
 else     if (val instanceof MapProperty) {
      undoReverseReplace((MapProperty)val);
    }
    newMap.put(val.getName(),val);
  }
  prop.setMap(newMap);
}
