{
  String action=e.getActionCommand();
  GuiPackage guiPackage=GuiPackage.getInstance();
  JMeterTreeNode[] draggedNodes=guiPackage.getTreeListener().getDraggedNodes();
  JMeterTreeListener treeListener=guiPackage.getTreeListener();
  JMeterTreeNode currentNode=treeListener.getCurrentNode();
  removeNodesFromParents(draggedNodes);
  if (ADD.equals(action)) {
    for (int i=0; i < draggedNodes.length; i++) {
      GuiPackage.getInstance().getTreeModel().insertNodeInto(draggedNodes[i],currentNode,currentNode.getChildCount());
    }
  }
 else   if (INSERT_BEFORE.equals(action)) {
    for (int i=0; i < draggedNodes.length; i++) {
      JMeterTreeNode parentNode=(JMeterTreeNode)currentNode.getParent();
      int index=parentNode.getIndex(currentNode);
      GuiPackage.getInstance().getTreeModel().insertNodeInto(draggedNodes[i],parentNode,index);
    }
  }
 else   if (INSERT_AFTER.equals(action)) {
    for (int i=0; i < draggedNodes.length; i++) {
      JMeterTreeNode parentNode=(JMeterTreeNode)currentNode.getParent();
      int index=parentNode.getIndex(currentNode) + 1;
      GuiPackage.getInstance().getTreeModel().insertNodeInto(draggedNodes[i],parentNode,index);
    }
  }
  GuiPackage.getInstance().getMainFrame().repaint();
}
