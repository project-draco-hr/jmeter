{
  JFileChooser chooser=FileDialoger.promptToOpenFile(new String[]{".jmx"});
  if (chooser == null) {
    return;
  }
  boolean isTestPlan=false;
  InputStream reader=null;
  File f=null;
  try {
    f=chooser.getSelectedFile();
    if (f != null) {
      reader=new FileInputStream(f);
      HashTree tree=SaveService.loadSubTree(reader);
      isTestPlan=insertLoadedTree(e.getID(),tree);
    }
  }
 catch (  IllegalUserActionException ex) {
    JMeterUtils.reportErrorToUser(ex.getMessage());
  }
catch (  Throwable ex) {
    try {
      isTestPlan=legacyLoad(f);
    }
 catch (    Throwable err) {
      log.error("",err);
      JMeterUtils.reportErrorToUser("Couldn't load JMX file.  May have been corrupted");
    }
  }
 finally {
    GuiPackage.getInstance().getMainFrame().repaint();
  }
  if (isTestPlan && f != null) {
    ((Save)ActionRouter.getInstance().getAction("save","org.apache.jmeter.gui.action.Save")).setTestPlanFile(f.getAbsolutePath());
  }
}
