{
  boolean merging=e.getActionCommand().equals("merge");
  if (!merging) {
    ActionRouter.getInstance().doActionNow(new ActionEvent(e.getSource(),e.getID(),"close"));
  }
  JFileChooser chooser=FileDialoger.promptToOpenFile(new String[]{".jmx"});
  if (chooser == null) {
    return;
  }
  boolean isTestPlan=false;
  InputStream reader=null;
  File f=null;
  try {
    f=chooser.getSelectedFile();
    if (f != null) {
      if (merging) {
        log.info("Merging file: " + f);
      }
 else {
        log.info("Loading file: " + f);
        FileServer.getFileServer().setBasedir(f.getAbsolutePath());
      }
      reader=new FileInputStream(f);
      HashTree tree=(HashTree)SaveService.loadTree(reader);
      isTestPlan=insertLoadedTree(e.getID(),tree);
    }
  }
 catch (  Exception ex) {
    String msg=ex.getMessage();
    if (msg == null) {
      msg="Unexpected error - see log for details";
      log.warn("Unexpected error",ex);
    }
    JMeterUtils.reportErrorToUser(msg);
  }
 finally {
    GuiPackage.getInstance().updateCurrentGui();
    GuiPackage.getInstance().getMainFrame().repaint();
  }
  if (isTestPlan && f != null) {
    ((Save)ActionRouter.getInstance().getAction("save","org.apache.jmeter.gui.action.Save")).setTestPlanFile(f.getAbsolutePath());
  }
}
