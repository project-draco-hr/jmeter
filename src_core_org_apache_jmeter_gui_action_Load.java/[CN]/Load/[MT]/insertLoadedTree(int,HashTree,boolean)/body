{
  if (tree == null) {
    throw new Exception("Error in TestPlan - see log file");
  }
  boolean isTestPlan=tree.getArray()[0] instanceof TestPlan;
  if (isTestPlan && !merging) {
    GuiPackage.getInstance().getTreeModel().clearTestPlan((TestElement)tree.getArray()[0]);
  }
  HashTree newTree=GuiPackage.getInstance().addSubTree(tree);
  GuiPackage.getInstance().updateCurrentGui();
  GuiPackage.getInstance().getMainFrame().getTree().setSelectionPath(new TreePath(((JMeterTreeNode)newTree.getArray()[0]).getPath()));
  tree=GuiPackage.getInstance().getCurrentSubTree();
  ActionEvent actionEvent=null;
  if (!merging) {
    actionEvent=new ActionEvent(tree.get(tree.getArray()[tree.size() - 1]),id,ActionNames.SUB_TREE_LOADED);
  }
 else {
    actionEvent=new ActionEvent(tree.get(tree.getArray()[tree.size() - 1]),id,ActionNames.SUB_TREE_MERGED);
  }
  ActionRouter.getInstance().actionPerformed(actionEvent);
  if (expandTree) {
    JTree jTree=GuiPackage.getInstance().getMainFrame().getTree();
    for (int i=0; i < jTree.getRowCount(); i++) {
      jTree.expandRow(i);
    }
  }
  return isTestPlan;
}
