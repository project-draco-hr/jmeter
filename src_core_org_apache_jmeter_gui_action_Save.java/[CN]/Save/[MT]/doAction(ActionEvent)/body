{
  HashTree subTree=null;
  if (e.getActionCommand().equals(SAVE)) {
    subTree=GuiPackage.getInstance().getCurrentSubTree();
  }
 else   if (e.getActionCommand().equals(SAVE_ALL) || e.getActionCommand().equals(SAVE_TO_PREVIOUS)) {
    subTree=GuiPackage.getInstance().getTreeModel().getTestPlan();
  }
  if (!SAVE_TO_PREVIOUS.equals(e.getActionCommand()) || testPlanFile == null) {
    JFileChooser chooser=FileDialoger.promptToSaveFile(GuiPackage.getInstance().getTreeListener().getCurrentNode().getName() + ".jmx");
    if (chooser == null) {
      return;
    }
    if (e.getActionCommand().equals(SAVE_ALL) || e.getActionCommand().equals(SAVE_TO_PREVIOUS)) {
      testPlanFile=chooser.getSelectedFile().getAbsolutePath();
      chosenFile=testPlanFile;
    }
 else {
      chosenFile=chooser.getSelectedFile().getAbsolutePath();
    }
  }
 else {
    chosenFile=testPlanFile;
  }
  ActionRouter.getInstance().doActionNow(new ActionEvent(subTree,e.getID(),CheckDirty.SUB_TREE_SAVED));
  try {
    convertSubTree(subTree);
  }
 catch (  Exception err) {
  }
  OutputStream writer=null;
  try {
    writer=new FileOutputStream(chosenFile);
    SaveService.saveSubTree(subTree,writer);
  }
 catch (  Throwable ex) {
    log.error("",ex);
  }
 finally {
    closeWriter(writer);
    GuiPackage.getInstance().getMainFrame().repaint();
  }
}
