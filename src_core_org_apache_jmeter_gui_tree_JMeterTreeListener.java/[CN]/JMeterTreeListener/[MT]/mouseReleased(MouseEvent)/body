{
  if (dragging && isValidDragAction(draggedNodes,getCurrentNode())) {
    dragging=false;
    JPopupMenu dragNdrop=new JPopupMenu();
    JMenuItem item=new JMenuItem(JMeterUtils.getResString("insert_before"));
    item.addActionListener(actionHandler);
    item.setActionCommand(ActionNames.INSERT_BEFORE);
    dragNdrop.add(item);
    item=new JMenuItem(JMeterUtils.getResString("insert_after"));
    item.addActionListener(actionHandler);
    item.setActionCommand(ActionNames.INSERT_AFTER);
    dragNdrop.add(item);
    if (MenuFactory.canAddTo(getCurrentNode(),draggedNodes)) {
      item=new JMenuItem(JMeterUtils.getResString("add_as_child"));
      item.addActionListener(actionHandler);
      item.setActionCommand(ActionNames.DRAG_ADD);
      dragNdrop.add(item);
    }
    dragNdrop.addSeparator();
    item=new JMenuItem(JMeterUtils.getResString("cancel"));
    dragNdrop.add(item);
    displayPopUp(e,dragNdrop);
  }
 else {
    GuiPackage.getInstance().getMainFrame().repaint();
  }
  dragging=false;
}
