{
  if (resultCollector != null) {
    log.info("Flushing result collector before report Generation");
    resultCollector.flushFile();
  }
  log.debug("Start report generation");
  File tmpDir=configuration.getTempDirectory();
  boolean tmpDirCreated=false;
  if (!tmpDir.exists()) {
    tmpDirCreated=tmpDir.mkdir();
    if (!tmpDirCreated) {
      String message=String.format("Cannot create temporary directory \"%s\".",tmpDir);
      log.error(message);
      throw new GenerationException(message);
    }
  }
  SampleContext sampleContext=new SampleContext();
  sampleContext.setWorkingDirectory(tmpDir);
  SampleSource source=new CsvFileSampleSource(testFile,JMeterUtils.getPropDefault("jmeter.save.saveservice.default_delimiter",",").charAt(0));
  source.setSampleContext(sampleContext);
  NormalizerSampleConsumer normalizer=new NormalizerSampleConsumer();
  normalizer.setName(NORMALIZER_CONSUMER_NAME);
  normalizer.addSampleConsumer(createBeginDateConsumer());
  normalizer.addSampleConsumer(createEndDateConsumer());
  FilterConsumer nameFilter=createNameFilter();
  FilterConsumer excludeControllerFilter=createExcludeControllerFilter();
  nameFilter.addSampleConsumer(excludeControllerFilter);
  normalizer.addSampleConsumer(nameFilter);
  source.addSampleConsumer(normalizer);
  Map<String,GraphConfiguration> graphConfigurations=configuration.getGraphConfigurations();
  for (  Map.Entry<String,GraphConfiguration> entryGraphCfg : graphConfigurations.entrySet()) {
    addGraphConsumer(nameFilter,excludeControllerFilter,entryGraphCfg);
  }
  log.debug("Start samples processing");
  try {
    source.run();
  }
 catch (  SampleException ex) {
    String message="Error while processing samples";
    log.error(message,ex);
    throw new GenerationException(message,ex);
  }
  log.debug("End of samples processing");
  log.debug("Start data exporting");
  for (  Map.Entry<String,ExporterConfiguration> entry : configuration.getExportConfigurations().entrySet()) {
    exportData(sampleContext,entry.getKey(),entry.getValue());
  }
  log.debug("End of data exporting");
  if (tmpDirCreated) {
    try {
      FileUtils.deleteDirectory(tmpDir);
    }
 catch (    IOException ex) {
      log.warn(String.format("Cannot delete created temporary directory \"%s\".",tmpDir),ex);
    }
  }
  log.debug("End of report generation");
}
