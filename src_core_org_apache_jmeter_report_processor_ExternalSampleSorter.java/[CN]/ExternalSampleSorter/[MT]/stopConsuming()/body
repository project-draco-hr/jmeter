{
  if (samples.size() > 0) {
    chunks.add(sortAndDump(samples,sampleMetadata));
  }
  if (log.isDebugEnabled()) {
    log.debug("sort(): " + inputSampleCount.longValue() + " samples read from input, "+ chunkedSampleCount.longValue()+ " samples written to chunk files");
    if (inputSampleCount.get() != chunkedSampleCount.get()) {
      log.error("Failure! Number of samples read from input and written to chunk files differ");
    }
 else {
      log.info("chunked samples dumps succeeded.");
    }
  }
  super.setProducedMetadata(sampleMetadata,0);
  super.startProducing();
  sortFilesParallel(chunks,sampleMetadata,this);
  super.stopProducing();
  if (this.pool != null) {
    this.pool.shutdown();
  }
  getWorkingDirectory().delete();
}
