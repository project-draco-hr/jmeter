{
  if (filename == null || filename.length() == 0) {
    return null;
  }
  PrintWriter writer=(PrintWriter)files.get(filename);
  boolean trimmed=true;
  if (writer == null) {
    if (SaveService.getOutputFormat() == SaveService.SAVE_AS_XML) {
      trimmed=trimLastLine(filename);
    }
    writer=new PrintWriter(new OutputStreamWriter(new BufferedOutputStream(new FileOutputStream(filename,trimmed)),"UTF-8"),true);
    files.put(filename,writer);
  }
  if (!trimmed) {
    writeFileStart(writer);
  }
  return writer;
}
