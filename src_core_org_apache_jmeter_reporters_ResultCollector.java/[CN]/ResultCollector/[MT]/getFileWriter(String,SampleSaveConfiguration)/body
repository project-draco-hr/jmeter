{
  if (filename == null || filename.length() == 0) {
    return null;
  }
  PrintWriter writer=(PrintWriter)files.get(filename);
  boolean trimmed=true;
  if (writer == null) {
    if (saveConfig.saveAsXml()) {
      trimmed=trimLastLine(filename);
    }
 else {
      trimmed=new File(filename).exists();
    }
    File pdir=new File(filename).getParentFile();
    if (pdir != null)     pdir.mkdirs();
    writer=new PrintWriter(new OutputStreamWriter(new BufferedOutputStream(new FileOutputStream(filename,trimmed)),"UTF-8"),true);
    files.put(filename,writer);
  }
  if (!trimmed) {
    writeFileStart(writer,saveConfig);
  }
  return writer;
}
