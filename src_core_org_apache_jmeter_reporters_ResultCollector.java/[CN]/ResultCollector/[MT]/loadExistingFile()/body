{
  boolean parsedOK=false, errorDetected=false;
  String filename=getFilename();
  File file=new File(filename);
  if (file.exists()) {
    clearVisualizer();
    BufferedReader dataReader=null;
    BufferedInputStream bufferedInputStream=null;
    try {
      dataReader=new BufferedReader(new FileReader(file));
      String line=dataReader.readLine();
      if (line == null) {
        log.warn(filename + " is empty");
      }
 else {
        if (!line.startsWith("<?xml ")) {
          while (line != null) {
            try {
              SampleResult result=OldSaveService.makeResultFromDelimitedString(line);
              if (result != null)               sendToVisualizer(result);
            }
 catch (            NumberFormatException ignored) {
              errorDetected=true;
            }
            line=dataReader.readLine();
          }
          parsedOK=true;
        }
 else {
          try {
            bufferedInputStream=new BufferedInputStream(new FileInputStream(file));
            readSamples(SaveService.loadTestResults(bufferedInputStream));
            parsedOK=true;
          }
 catch (          Exception e) {
            log.info("File load failure, trying old XML format. " + e.getLocalizedMessage());
            try {
              Configuration savedSamples=getConfiguration(filename);
              Configuration[] samples=savedSamples.getChildren();
              for (int i=0; i < samples.length; i++) {
                SampleResult result=OldSaveService.getSampleResult(samples[i]);
                sendToVisualizer(result);
              }
              parsedOK=true;
            }
 catch (            Exception e1) {
              log.warn("Error parsing Avalon XML. " + e1.getLocalizedMessage());
            }
          }
        }
      }
    }
 catch (    IOException e) {
      log.warn("Problem reading JTL file " + e.getLocalizedMessage());
    }
 finally {
      JOrphanUtils.closeQuietly(dataReader);
      JOrphanUtils.closeQuietly(bufferedInputStream);
      if (!parsedOK || errorDetected) {
        GuiPackage.showErrorMessage("Error loading results file - see log file","CSV Result file loader");
      }
    }
  }
}
