{
synchronized (sampleStore) {
    sampleStore.add(e);
    if (numSamplesThreshold != -1) {
      if (sampleStore.size() >= numSamplesThreshold) {
        try {
          log.debug("Firing sample");
          listener.processBatch(sampleStore);
          sampleStore.clear();
        }
 catch (        RemoteException err) {
          log.error("sampleOccurred",err);
        }
      }
    }
    if (TIME_THRESHOLD_MS != -1) {
      SampleResult sr=e.getResult();
      long timestamp=sr.getTimeStamp();
      if (batchSendTime == -1) {
        this.batchSendTime=timestamp + TIME_THRESHOLD_MS;
      }
      if (batchSendTime < timestamp) {
        try {
          log.debug("Firing time");
          if (sampleStore.size() > 0) {
            listener.processBatch(sampleStore);
            sampleStore.clear();
          }
          this.batchSendTime=timestamp + TIME_THRESHOLD_MS;
        }
 catch (        RemoteException err) {
          log.error("sampleOccurred",err);
        }
      }
    }
  }
}
