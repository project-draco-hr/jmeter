{
  if (!reader.markSupported()) {
    reader=new BufferedInputStream(reader);
  }
  reader.mark(Integer.MAX_VALUE);
  ScriptWrapper wrapper=null;
  try {
    InputStreamReader inputStreamReader=getInputStreamReader(reader);
    wrapper=(ScriptWrapper)JMXSAVER.fromXML(inputStreamReader);
    inputStreamReader.close();
    if (wrapper == null) {
      log.error("Problem loading XML: see above.");
      return null;
    }
    return wrapper.testPlan;
  }
 catch (  CannotResolveClassException e) {
    if (e.getMessage().startsWith("node")) {
      log.info("Problem loading XML, trying Avalon format");
      reader.reset();
      return OldSaveService.loadSubTree(reader);
    }
    log.warn("Problem loading XML, cannot determine class for element: " + e.getLocalizedMessage());
    return null;
  }
catch (  NoClassDefFoundError e) {
    log.error("Missing class " + e);
    return null;
  }
catch (  ConversionException e) {
    log.error("Conversion error " + e);
    return null;
  }
}
