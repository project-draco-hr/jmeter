{
  if (!reader.markSupported()) {
    reader=new BufferedInputStream(reader);
  }
  reader.mark(Integer.MAX_VALUE);
  ScriptWrapper wrapper=null;
  try {
    InputStreamReader inputStreamReader=getInputStreamReader(reader);
    wrapper=(ScriptWrapper)JMXSAVER.fromXML(inputStreamReader);
    inputStreamReader.close();
    if (wrapper == null) {
      log.error("Problem loading new style: see above.");
      return null;
    }
    return wrapper.testPlan;
  }
 catch (  CannotResolveClassException e) {
    log.warn("Problem loading new style: " + e.getLocalizedMessage());
    reader.reset();
    return OldSaveService.loadSubTree(reader);
  }
catch (  NoClassDefFoundError e) {
    log.error("Missing class " + e);
    return null;
  }
catch (  ConversionException e) {
    log.error("Conversion error " + e);
    return null;
  }
}
