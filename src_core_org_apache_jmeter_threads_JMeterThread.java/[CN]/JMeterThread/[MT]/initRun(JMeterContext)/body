{
  threadContext.setVariables(threadVars);
  threadContext.setThreadNum(getThreadNum());
  threadContext.getVariables().put(LAST_SAMPLE_OK,TRUE);
  threadContext.setThread(this);
  threadContext.setThreadGroup(threadGroup);
  threadContext.setEngine(engine);
  testTree.traverse(compiler);
  if (scheduler) {
    startScheduler();
  }
  rampUpDelay();
  log.info("Thread started: " + Thread.currentThread().getName());
  if (startEarlier) {
    threadContext.setSamplingStarted(true);
  }
  controller.initialize();
  IterationListener iterationListener=new IterationListener();
  controller.addIterationListener(iterationListener);
  if (!startEarlier) {
    threadContext.setSamplingStarted(true);
  }
  threadStarted();
  return iterationListener;
}
