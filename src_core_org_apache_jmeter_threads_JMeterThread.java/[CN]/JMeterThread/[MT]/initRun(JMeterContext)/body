{
  threadContext.setVariables(threadVars);
  threadContext.setThreadNum(getThreadNum());
  threadContext.getVariables().put(LAST_SAMPLE_OK,"true");
  threadContext.setThread(this);
  threadContext.setThreadGroup(threadGroup);
  threadContext.setEngine(engine);
  testTree.traverse(compiler);
  if (scheduler) {
    startScheduler();
  }
  rampUpDelay();
  log.info("Thread started: " + Thread.currentThread().getName());
  JMeterContextService.incrNumberOfThreads();
  threadGroup.incrNumberOfThreads();
  GuiPackage gp=GuiPackage.getInstance();
  if (gp != null) {
    gp.getMainFrame().updateCounts();
  }
  if (startEarlier) {
    threadContext.setSamplingStarted(true);
  }
  controller.initialize();
  controller.addIterationListener(new IterationListener());
  if (!startEarlier) {
    threadContext.setSamplingStarted(true);
  }
  threadStarted();
}
