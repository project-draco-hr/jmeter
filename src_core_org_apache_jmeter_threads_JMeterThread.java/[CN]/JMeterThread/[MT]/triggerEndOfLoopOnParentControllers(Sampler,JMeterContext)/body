{
  FindTestElementsUpToRootTraverser pathToRootTraverser=null;
  TransactionSampler transactionSampler=null;
  if (sam instanceof TransactionSampler) {
    transactionSampler=(TransactionSampler)sam;
    pathToRootTraverser=new FindTestElementsUpToRootTraverser(transactionSampler.getTransactionController());
  }
 else {
    pathToRootTraverser=new FindTestElementsUpToRootTraverser(sam);
  }
  testTree.traverse(pathToRootTraverser);
  List<Controller> controllersToReinit=pathToRootTraverser.getControllersToRoot();
  for (  Controller parentController : controllersToReinit) {
    if (parentController instanceof AbstractThreadGroup) {
      AbstractThreadGroup tg=(AbstractThreadGroup)parentController;
      tg.startNextLoop();
    }
 else {
      parentController.triggerEndOfLoop();
    }
  }
  if (transactionSampler != null) {
    SamplePackage transactionPack=compiler.configureTransactionSampler(transactionSampler);
    doEndTransactionSampler(transactionSampler,null,transactionPack,threadContext);
  }
}
