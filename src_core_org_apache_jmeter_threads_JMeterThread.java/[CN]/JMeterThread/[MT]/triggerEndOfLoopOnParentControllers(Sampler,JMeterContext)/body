{
  FindTestElementsUpToRootTraverser pathToRootTraverser=null;
  TransactionSampler transactionSampler=null;
  if (sam instanceof TransactionSampler) {
    transactionSampler=(TransactionSampler)sam;
    pathToRootTraverser=new FindTestElementsUpToRootTraverser((transactionSampler).getTransactionController());
  }
 else {
    pathToRootTraverser=new FindTestElementsUpToRootTraverser(sam);
  }
  testTree.traverse(pathToRootTraverser);
  List<Controller> controllersToReinit=pathToRootTraverser.getControllersToRoot();
  for (Iterator<Controller> iterator=controllersToReinit.iterator(); iterator.hasNext(); ) {
    Controller parentController=iterator.next();
    if (parentController instanceof AbstractThreadGroup) {
      AbstractThreadGroup tg=(AbstractThreadGroup)parentController;
      tg.startNextLoop();
    }
 else {
      parentController.triggerEndOfLoop();
    }
  }
  if (transactionSampler != null) {
    processSampler(transactionSampler,null,threadContext);
  }
}
