{
  currentSampler=sampler;
  SamplePackage ret=new SamplePackage();
  Sampler clonedSampler=sampler;
  SamplerConfigs configs=(SamplerConfigs)samplerConfigMap.get(sampler);
  if (sampler instanceof PerSampleClonable) {
    clonedSampler=(Sampler)sampler.clone();
  }
  if (objectsWithFunctions.contains(sampler)) {
    replaceValues(clonedSampler);
  }
  ret.setSampler(clonedSampler);
  ret.addSampleListener(this);
  configureWithConfigElements(clonedSampler,configs.getConfigs());
  configureWithResponseModifiers(clonedSampler,configs.getResponseModifiers());
  configureWithModifiers(clonedSampler,configs.getModifiers());
  configureSamplerPackage(ret,configs);
  return ret;
}
