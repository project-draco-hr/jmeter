{
  List<ConfigTestElement> configs=new LinkedList<ConfigTestElement>();
  List<TestElement> controllers=new LinkedList<TestElement>();
  List<SampleListener> listeners=new LinkedList<SampleListener>();
  List<Timer> timers=new LinkedList<Timer>();
  List<Assertion> assertions=new LinkedList<Assertion>();
  LinkedList<PostProcessor> posts=new LinkedList<PostProcessor>();
  LinkedList<PreProcessor> pres=new LinkedList<PreProcessor>();
  for (int i=stack.size(); i > 0; i--) {
    addDirectParentControllers(controllers,stack.get(i - 1));
    Iterator<?> iter=testTree.list(stack.subList(0,i)).iterator();
    List<PreProcessor> tempPre=new LinkedList<PreProcessor>();
    List<PostProcessor> tempPost=new LinkedList<PostProcessor>();
    while (iter.hasNext()) {
      Object item=iter.next();
      if ((item instanceof ConfigTestElement)) {
        configs.add((ConfigTestElement)item);
      }
      if (item instanceof SampleListener) {
        listeners.add((SampleListener)item);
      }
      if (item instanceof Timer) {
        timers.add((Timer)item);
      }
      if (item instanceof Assertion) {
        assertions.add((Assertion)item);
      }
      if (item instanceof PostProcessor) {
        tempPost.add((PostProcessor)item);
      }
      if (item instanceof PreProcessor) {
        tempPre.add((PreProcessor)item);
      }
    }
    pres.addAll(0,tempPre);
    posts.addAll(0,tempPost);
  }
  SamplePackage pack=new SamplePackage(configs,listeners,timers,assertions,posts,pres,controllers);
  pack.setSampler(sam);
  pack.setRunningVersion(true);
  samplerConfigMap.put(sam,pack);
}
