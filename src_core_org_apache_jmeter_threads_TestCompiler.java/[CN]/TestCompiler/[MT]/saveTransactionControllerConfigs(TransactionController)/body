{
  List configs=new LinkedList();
  List modifiers=new LinkedList();
  List controllers=new LinkedList();
  List responseModifiers=new LinkedList();
  List listeners=new LinkedList();
  List timers=new LinkedList();
  List assertions=new LinkedList();
  LinkedList posts=new LinkedList();
  LinkedList pres=new LinkedList();
  for (int i=stack.size(); i > 0; i--) {
    addDirectParentControllers(controllers,(TestElement)stack.get(i - 1));
    Iterator iter=testTree.list(stack.subList(0,i)).iterator();
    while (iter.hasNext()) {
      TestElement item=(TestElement)iter.next();
      if (item instanceof SampleListener) {
        listeners.add(item);
      }
      if (item instanceof Assertion) {
        assertions.add(item);
      }
    }
  }
  SamplePackage pack=new SamplePackage(configs,modifiers,responseModifiers,listeners,timers,assertions,posts,pres,controllers);
  pack.setSampler(new TransactionSampler(tc,tc.getName()));
  pack.setRunningVersion(true);
  transactionControllerConfigMap.put(tc,pack);
}
