{
  ClassLoader loader=Thread.currentThread().getContextClassLoader();
  try {
    Class Interpreter=loader.loadClass("bsh.Interpreter");
    Object instance=Interpreter.newInstance();
    Class string=String.class;
    Class object=Object.class;
    Method eval=Interpreter.getMethod("eval",new Class[]{string});
    Method setObj=Interpreter.getMethod("set",new Class[]{string,object});
    Method setInt=Interpreter.getMethod("set",new Class[]{string,int.class});
    Method source=Interpreter.getMethod("source",new Class[]{string});
    setObj.invoke(instance,new Object[]{"t",this});
    setInt.invoke(instance,new Object[]{"portnum",new Integer(serverport)});
    if (serverfile.length() > 0) {
      try {
        source.invoke(instance,new Object[]{serverfile});
      }
 catch (      InvocationTargetException e1) {
        log.warn("Could not source " + serverfile);
        Throwable t=e1.getCause();
        if (t != null)         log.warn(t.toString());
      }
    }
    eval.invoke(instance,new Object[]{"server(portnum)"});
  }
 catch (  ClassNotFoundException e) {
    log.error("Beanshell Interpreter not found");
  }
catch (  Exception e) {
    log.error("Problem starting BeanShell server ",e);
  }
}
