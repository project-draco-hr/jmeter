{
  if (!(socket instanceof SSLSocket)) {
    throw new IllegalArgumentException("Expected SSLSocket");
  }
  SSLSocket sock=(SSLSocket)socket;
  if (log.isDebugEnabled()) {
    SSLSession sslSession=sock.getSession();
    byte[] bytes=sslSession.getId();
    StringBuffer buffer=new StringBuffer("SSL session id: ");
    for (int i=0; i < bytes.length; i++) {
      int b=bytes[i] & 0xff;
      buffer.append(Character.toUpperCase(Character.forDigit((b >> 4) & 0xF,16)));
      buffer.append(Character.toUpperCase(Character.forDigit(b & 0xF,16)));
    }
    buffer.append(" for ").append(Thread.currentThread().getName());
    log.debug(buffer.toString());
  }
  if (protocolList.length() > 0) {
    try {
      sock.setEnabledProtocols(protocols);
    }
 catch (    IllegalArgumentException e) {
      log.warn("Could not set protocol list: " + protocolList + ".");
      log.warn("Valid protocols are: " + join(sock.getSupportedProtocols()));
    }
  }
}
