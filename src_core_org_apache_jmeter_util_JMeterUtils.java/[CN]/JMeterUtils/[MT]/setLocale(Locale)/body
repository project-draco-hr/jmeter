{
  log.info("Setting Locale to " + loc.toString());
  Locale def=null;
  boolean isDefault=false;
  if (loc.getLanguage().equals(Locale.ENGLISH.getLanguage())) {
    isDefault=true;
    def=Locale.getDefault();
    if (!def.getLanguage().equals(Locale.ENGLISH.getLanguage())) {
      Locale.setDefault(Locale.ENGLISH);
    }
 else {
      def=null;
    }
  }
  if (loc.toString().equals("ignoreResources")) {
    log.warn("Resource bundles will be ignored");
    ignoreResorces=true;
  }
 else {
    ignoreResorces=false;
    ResourceBundle resBund=ResourceBundle.getBundle("org.apache.jmeter.resources.messages",loc);
    if (isDefault || resBund.getLocale().equals(loc)) {
      resources=resBund;
      locale=loc;
    }
 else     if (resBund.getLocale().getLanguage().equals(loc.getLanguage())) {
      log.warn("Unable to change language to '" + loc.toString() + "', using '"+ loc.getLanguage()+ "'");
      resources=resBund;
      locale=loc;
    }
 else {
      log.error("Unable to change language to " + loc.toString());
      throw new JMeterError("Unable to change language to " + loc.toString());
    }
  }
  notifyLocaleChangeListeners();
  if (def != null) {
    Locale.setDefault(def);
  }
}
