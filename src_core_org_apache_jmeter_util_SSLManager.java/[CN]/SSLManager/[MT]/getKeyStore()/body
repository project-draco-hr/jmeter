{
  if (null == this.keyStore) {
    String defaultName=JMeterUtils.getJMeterProperties().getProperty("user.home") + File.separator + ".keystore";
    String fileName=System.getProperty(JAVAX_NET_SSL_KEY_STORE,defaultName);
    log.info("JmeterKeyStore Location: " + fileName);
    try {
      if (fileName.endsWith(".p12") || fileName.endsWith(".P12")) {
        this.keyStore=JmeterKeyStore.getInstance(PKCS12);
        log.info("KeyStore created OK, Type: PKCS 12");
        System.setProperty("javax.net.ssl.keyStoreType",PKCS12);
      }
 else {
        this.keyStore=JmeterKeyStore.getInstance("JKS");
        log.info("KeyStore created OK, Type: JKS");
      }
    }
 catch (    Exception e) {
      this.keyStore=null;
      throw new RuntimeException("Could not create keystore: " + e.getMessage());
    }
    FileInputStream fileInputStream=null;
    try {
      File initStore=new File(fileName);
      if (initStore.exists()) {
        fileInputStream=new FileInputStream(initStore);
        this.keyStore.load(fileInputStream,getPassword());
        log.info("Keystore loaded OK from file");
      }
 else {
        log.warn("Keystore file not found, loading empty keystore");
        this.defaultpw="";
        this.keyStore.load(null,"");
      }
    }
 catch (    Exception e) {
      log.error("Problem loading keystore: " + e.getMessage());
    }
 finally {
      JOrphanUtils.closeQuietly(fileInputStream);
    }
    log.debug("JmeterKeyStore type: " + this.keyStore.getClass().toString());
  }
  return this.keyStore;
}
