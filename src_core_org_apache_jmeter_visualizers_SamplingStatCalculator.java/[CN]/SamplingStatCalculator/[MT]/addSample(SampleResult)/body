{
  Sample s=null;
synchronized (calculator) {
    calculator.addValue(res.getTime());
    calculator.addBytes((long)res.getResponseData().length);
    setStartTime(res);
    long eCount=getCurrentSample().errorCount;
    if (!res.isSuccessful()) {
      eCount++;
    }
    long endTime=getEndTime(res);
    long howLongRunning=endTime - firstTime;
    double throughput=0;
    if (howLongRunning <= 0) {
      throughput=Double.MAX_VALUE;
    }
    throughput=(double)((double)calculator.getCount() / (double)howLongRunning) * 1000.0;
    if (throughput > maxThroughput) {
      maxThroughput=throughput;
    }
    s=new Sample(null,res.getTime(),(long)calculator.getMean(),(long)calculator.getStandardDeviation(),calculator.getMedian().longValue(),calculator.getPercentPoint(0.500).longValue(),throughput,eCount,res.isSuccessful(),storedValues.size() + 1,endTime);
    storedValues.add(s);
  }
  return s;
}
