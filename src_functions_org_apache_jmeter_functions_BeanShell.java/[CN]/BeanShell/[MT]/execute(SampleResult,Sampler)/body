{
  if (bshSet == null) {
    throw new InvalidVariableException("BeanShell not found");
  }
  JMeterContext jmctx=JMeterContextService.getContext();
  JMeterVariables vars=jmctx.getVariables();
  String script=((CompoundVariable)values[0]).execute();
  String varName="";
  if (values.length > 1) {
    varName=((CompoundVariable)values[1]).execute();
  }
  String resultStr="";
  log.debug("Script=" + script);
  try {
    if (currentSampler != null) {
      bshInvoke(bshSet,"Sampler",currentSampler);
    }
    if (previousResult != null) {
      bshInvoke(bshSet,"SampleResult",previousResult);
    }
    bshInvoke(bshSet,"ctx",jmctx);
    bshInvoke(bshSet,"vars",vars);
    bshInvoke(bshSet,"threadName",Thread.currentThread().getName());
    Object bshOut=bshInvoke(bshEval,script,null);
    if (bshOut != null) {
      resultStr=bshOut.toString();
    }
    if (varName.length() > 0) {
      vars.put(varName,resultStr);
    }
  }
 catch (  Exception ex) {
    log.warn("Error running BSH script",ex);
  }
  log.debug("Output=" + resultStr);
  return resultStr;
}
