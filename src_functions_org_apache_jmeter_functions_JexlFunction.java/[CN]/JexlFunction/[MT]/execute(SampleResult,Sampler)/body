{
  String str="";
  CompoundVariable var=(CompoundVariable)values[0];
  String exp=var.execute();
  String varName="";
  if (values.length > 1) {
    varName=((CompoundVariable)values[1]).execute().trim();
  }
  JMeterContext jmctx=JMeterContextService.getContext();
  JMeterVariables vars=jmctx.getVariables();
  try {
    Expression e=ExpressionFactory.createExpression(exp);
    JexlContext jc=JexlHelper.createContext();
    final Map jexlVars=jc.getVars();
    jexlVars.put("ctx",jmctx);
    jexlVars.put("vars",vars);
    jexlVars.put("props",JMeterUtils.getJMeterProperties());
    jexlVars.put("theadName",Thread.currentThread().getName());
    jexlVars.put("sampler",currentSampler);
    jexlVars.put("sampleResult",previousResult);
    Object o=e.evaluate(jc);
    if (o != null) {
      str=o.toString();
    }
    if (vars != null && varName.length() > 0) {
      vars.put(varName,str);
    }
  }
 catch (  Exception e) {
    log.error("An error occurred while evaluating the expression \"" + exp + "\"\n",e);
  }
  return str;
}
