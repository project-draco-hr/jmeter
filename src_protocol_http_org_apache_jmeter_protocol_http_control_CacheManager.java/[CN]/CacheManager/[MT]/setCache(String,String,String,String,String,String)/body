{
  if (log.isDebugEnabled()) {
    log.debug("SET(both) " + url + " "+ cacheControl+ " "+ lastModified+ " "+ " "+ expires+ " "+ etag);
  }
  Date expiresDate=null;
  if (useExpires) {
    final String MAX_AGE="max-age=";
    if (expires != null) {
      try {
        expiresDate=DateUtil.parseDate(expires);
      }
 catch (      DateParseException e) {
        if (log.isDebugEnabled()) {
          log.debug("Unable to parse Expires: '" + expires + "' "+ e);
        }
        expiresDate=new Date(0L);
      }
    }
    if (cacheControl != null && !cacheControl.contains("no-cache")) {
      if (cacheControl.contains(MAX_AGE)) {
        long maxAgeInSecs=Long.parseLong(cacheControl.substring(cacheControl.indexOf(MAX_AGE) + MAX_AGE.length()).split("[, ]")[0]);
        expiresDate=new Date(System.currentTimeMillis() + maxAgeInSecs * 1000);
      }
 else       if (expires == null) {
        if (!StringUtils.isEmpty(lastModified)) {
          try {
            Date responseDate=DateUtil.parseDate(date);
            Date lastModifiedAsDate=DateUtil.parseDate(lastModified);
            expiresDate=new Date(System.currentTimeMillis() + Math.round((responseDate.getTime() - lastModifiedAsDate.getTime()) * 0.1));
          }
 catch (          DateParseException e) {
            expiresDate=new Date(0L);
          }
        }
      }
    }
  }
  getCache().put(url,new CacheEntry(lastModified,expiresDate,etag));
}
