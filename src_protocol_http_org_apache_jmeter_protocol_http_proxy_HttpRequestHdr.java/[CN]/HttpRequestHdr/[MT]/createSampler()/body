{
  MultipartUrlConfig urlConfig=null;
  HTTPSamplerBase sampler=HTTPSamplerFactory.newInstance();
  sampler.setDomain(serverName());
  if (log.isDebugEnabled())   log.debug("Proxy: setting server: " + sampler.getDomain());
  sampler.setMethod(method);
  log.debug("Proxy: method server: " + sampler.getMethod());
  sampler.setPath(serverUrl());
  if (log.isDebugEnabled())   log.debug("Proxy: setting path: " + sampler.getPath());
  if (numberRequests) {
    requestNumber++;
    sampler.setName(requestNumber + " " + sampler.getPath());
  }
 else {
    sampler.setName(sampler.getPath());
  }
  sampler.setPort(serverPort());
  if (log.isDebugEnabled())   log.debug("Proxy: setting port: " + sampler.getPort());
  if (url.indexOf("//") > -1) {
    String protocol=url.substring(0,url.indexOf(":"));
    if (log.isDebugEnabled())     log.debug("Proxy: setting protocol to : " + protocol);
    sampler.setProtocol(protocol);
  }
 else   if (sampler.getPort() == 443) {
    sampler.setProtocol(HTTPS);
    if (log.isDebugEnabled())     log.debug("Proxy: setting protocol to https");
  }
 else {
    if (log.isDebugEnabled())     log.debug("Proxy setting default protocol to: http");
    sampler.setProtocol(HTTP);
  }
  if ((urlConfig=isMultipart(getContentType())) != null) {
    urlConfig.parseArguments(postData);
    sampler.setArguments(urlConfig.getArguments());
    sampler.setFileField(urlConfig.getFileFieldName());
    sampler.setFilename(urlConfig.getFilename());
    sampler.setMimetype(urlConfig.getMimeType());
  }
 else   if (postData != null && postData.trim().startsWith("<?")) {
    sampler.addNonEncodedArgument("",postData,"");
  }
 else {
    sampler.parseArguments(postData);
  }
  if (log.isDebugEnabled())   log.debug("sampler path = " + sampler.getPath());
  return sampler;
}
