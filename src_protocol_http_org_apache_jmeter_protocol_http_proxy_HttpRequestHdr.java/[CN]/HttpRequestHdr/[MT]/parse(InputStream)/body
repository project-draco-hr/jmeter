{
  boolean inHeaders=true;
  int readLength=0;
  int dataLength=0;
  boolean first=true;
  ByteArrayOutputStream clientRequest=new ByteArrayOutputStream();
  ByteArrayOutputStream line=new ByteArrayOutputStream();
  int x;
  while ((inHeaders || readLength < dataLength) && ((x=in.read()) != -1)) {
    line.write(x);
    clientRequest.write(x);
    if (inHeaders && (byte)x == (byte)'\n') {
      if (line.size() < 3) {
        inHeaders=false;
      }
      if (first) {
        parseFirstLine(line.toString());
        first=false;
      }
 else {
        dataLength=Math.max(parseLine(line.toString()),dataLength);
      }
      if (log.isDebugEnabled()) {
        log.debug("Client Request Line: " + line.toString());
      }
      line.reset();
    }
 else     if (!inHeaders) {
      readLength++;
    }
  }
  rawPostData=line.toByteArray();
  if (log.isDebugEnabled()) {
    log.debug("rawPostData in default JRE encoding: " + new String(rawPostData));
    log.debug("Request: " + clientRequest.toString());
  }
  return clientRequest.toByteArray();
}
