{
  final String ipSource=getIpSource();
  if (ipSource.length() > 0) {
    if (ipSource.startsWith(DEVICE_PREFIX)) {
      String interfaceName=ipSource.substring(DEVICE_PREFIX.length());
      final Class<? extends InetAddress> ipClass;
      if (interfaceName.startsWith(IPV4)) {
        interfaceName=interfaceName.substring(IPV4.length());
        ipClass=Inet4Address.class;
      }
 else       if (interfaceName.startsWith(IPV6)) {
        interfaceName=interfaceName.substring(IPV6.length());
        ipClass=Inet6Address.class;
      }
 else {
        ipClass=InetAddress.class;
      }
      NetworkInterface net=NetworkInterface.getByName(interfaceName);
      if (net != null) {
        for (        InterfaceAddress ia : net.getInterfaceAddresses()) {
          final InetAddress inetAddr=ia.getAddress();
          if (ipClass.isInstance(inetAddr)) {
            return inetAddr;
          }
        }
        throw new UnknownHostException("Interface " + interfaceName + " does not have address of type "+ ipClass.getSimpleName());
      }
      throw new UnknownHostException("Cannot find interface " + interfaceName);
    }
    return InetAddress.getByName(ipSource);
  }
  return null;
}
