{
  if (getDataEncodingNoDefault() == null && getContentType().startsWith("text/html")) {
    byte[] bytes=getResponseData();
    String prefix=new String(bytes,0,Math.min(bytes.length,2000)).toLowerCase(java.util.Locale.ENGLISH);
    final String METATAG="<meta http-equiv=\"content-type\" content=\"";
    int tagstart=prefix.indexOf(METATAG);
    if (tagstart != -1) {
      tagstart+=METATAG.length();
      int tagend=prefix.indexOf('\"',tagstart);
      if (tagend != -1) {
        final String ct=new String(bytes,tagstart,tagend - tagstart);
        setEncodingAndType(ct);
      }
    }
  }
  return super.getDataEncodingWithDefault(DEFAULT_HTTP_ENCODING);
}
