{
  byte[] readBuffer=getThreadContext().getReadBuffer();
  BufferedInputStream in;
  boolean logError=false;
  try {
    if ("gzip".equals(conn.getContentEncoding())) {
      in=new BufferedInputStream(new GZIPInputStream(conn.getInputStream()));
    }
 else {
      in=new BufferedInputStream(conn.getInputStream());
    }
  }
 catch (  IOException e) {
{
      log.error(e.toString());
      logError=true;
    }
    in=new BufferedInputStream(conn.getErrorStream());
  }
catch (  Exception e) {
    log.error(e.toString());
    in=new BufferedInputStream(conn.getErrorStream());
    logError=true;
  }
  java.io.ByteArrayOutputStream w=new ByteArrayOutputStream();
  int x=0;
  while ((x=in.read(readBuffer)) > -1) {
    w.write(readBuffer,0,x);
  }
  in.close();
  w.flush();
  w.close();
  if (logError) {
    String s;
    if (w.size() > 1000) {
      s="\n" + w.toString().substring(0,1000) + "\n\t...";
    }
 else {
      s="\n" + w.toString();
    }
    log.error(s);
  }
  return w.toByteArray();
}
