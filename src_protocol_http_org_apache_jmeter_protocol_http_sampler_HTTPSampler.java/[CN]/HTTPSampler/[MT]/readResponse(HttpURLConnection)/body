{
  byte[] readBuffer=JMeterContextService.getContext().getReadBuffer();
  BufferedInputStream in;
  try {
    if (conn.getContentEncoding() != null && conn.getContentEncoding().equals("gzip")) {
      in=new BufferedInputStream(new GZIPInputStream(conn.getInputStream()));
    }
 else {
      in=new BufferedInputStream(conn.getInputStream());
    }
  }
 catch (  IOException e) {
    if (e.getCause() instanceof FileNotFoundException) {
      log.warn(e.getCause().toString());
    }
 else {
      log.error("Getting error message from server: " + e.toString());
    }
    in=new BufferedInputStream(conn.getErrorStream());
  }
catch (  Exception e) {
    log.error("Getting error message from server: " + e.toString());
    in=new BufferedInputStream(conn.getErrorStream());
  }
  java.io.ByteArrayOutputStream w=new ByteArrayOutputStream();
  int x=0;
  while ((x=in.read(readBuffer)) > -1) {
    w.write(readBuffer,0,x);
  }
  in.close();
  w.flush();
  w.close();
  return w.toByteArray();
}
