{
  String filename=getFilename();
  if ((filename != null) && (filename.trim().length() > 0)) {
    if (getSendFileAsPostBody()) {
      post.setRequestEntity(new FileRequestEntity(new File(filename),null));
    }
 else {
      int argc=getArguments().getArgumentCount();
      Part[] parts=new Part[argc + 1];
      PropertyIterator args=getArguments().iterator();
      int i=0;
      while (args.hasNext()) {
        Argument arg=(Argument)args.next().getObjectValue();
        parts[i++]=new StringPart(arg.getName(),arg.getValue());
      }
      File input=new File(filename);
      parts[i]=new FilePart(getFileField(),input,getMimetype(),"UTF-8");
      post.setRequestEntity(new MultipartRequestEntity(parts,post.getParams()));
    }
  }
 else {
    PropertyIterator args=getArguments().iterator();
    while (args.hasNext()) {
      Argument arg=(Argument)args.next().getObjectValue();
      post.addParameter(arg.getName(),arg.getValue());
    }
  }
}
