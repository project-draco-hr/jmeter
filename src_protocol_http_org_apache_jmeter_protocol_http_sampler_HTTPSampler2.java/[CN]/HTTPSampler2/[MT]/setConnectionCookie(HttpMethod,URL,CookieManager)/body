{
  String cookieHeader="";
  if (cookieManager != null) {
    String host="." + u.getHost();
    for (int i=cookieManager.getCookies().size() - 1; i >= 0; i--) {
      Cookie cookie=(Cookie)cookieManager.getCookies().get(i).getObjectValue();
      if (cookie == null)       continue;
      long exp=cookie.getExpires();
      long now=System.currentTimeMillis() / 1000;
      if (host.endsWith(cookie.getDomain()) && u.getFile().startsWith(cookie.getPath()) && (exp == 0 || exp > now)) {
        org.apache.commons.httpclient.Cookie newCookie=new org.apache.commons.httpclient.Cookie(cookie.getDomain(),cookie.getName(),cookie.getValue(),cookie.getPath(),null,false);
        httpState.addCookie(newCookie);
        cookieHeader+=cookie.getName() + "=" + cookie.getValue();
      }
    }
  }
  return cookieHeader;
}
