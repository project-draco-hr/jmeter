{
  String filename=sampler.getFilename();
  if ((filename != null) && (filename.trim().length() > 0)) {
    OutputStream out=connection.getOutputStream();
    writeln(out,"--" + BOUNDARY);
    PropertyIterator args=sampler.getArguments().iterator();
    while (args.hasNext()) {
      Argument arg=(Argument)args.next().getObjectValue();
      writeFormMultipartStyle(out,arg.getName(),arg.getValue());
      writeln(out,"--" + BOUNDARY);
    }
    writeFileToURL(out,filename,sampler.getFileField(),getFileStream(filename),sampler.getMimetype());
    writeln(out,"--" + BOUNDARY + "--");
    out.flush();
    out.close();
  }
 else {
    String postData=sampler.getQueryString();
    PrintWriter out=new PrintWriter(connection.getOutputStream());
    out.print(postData);
    out.flush();
  }
}
