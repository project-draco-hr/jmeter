{
  ((HttpURLConnection)connection).setRequestMethod(HTTPSamplerBase.POST);
  String filename=sampler.getFilename();
  if ((filename != null) && (filename.trim().length() > 0)) {
    if (!sampler.getSendFileAsPostBody()) {
      String hct=connection.getRequestProperty(HTTPSamplerBase.HEADER_CONTENT_TYPE);
      if (hct == null || hct.length() == 0) {
        connection.setRequestProperty(HTTPSamplerBase.HEADER_CONTENT_TYPE,"multipart/form-data; boundary=" + BOUNDARY);
      }
    }
    connection.setDoOutput(true);
    connection.setDoInput(true);
  }
 else {
    String postData=sampler.getQueryString();
    connection.setRequestProperty(HTTPSamplerBase.HEADER_CONTENT_LENGTH,Integer.toString(postData.length()));
    String hct=connection.getRequestProperty(HTTPSamplerBase.HEADER_CONTENT_TYPE);
    if (hct == null || hct.length() == 0) {
      connection.setRequestProperty(HTTPSamplerBase.HEADER_CONTENT_TYPE,HTTPSamplerBase.APPLICATION_X_WWW_FORM_URLENCODED);
    }
    connection.setDoOutput(true);
  }
}
