{
  StringBuffer postedBody=new StringBuffer(1000);
  final String xmlFile=getXmlFile();
  if (xmlFile != null && xmlFile.length() > 0) {
    postedBody.append("Filename: ").append(xmlFile).append("\n");
    postedBody.append("<actual file content, not shown here>");
    post.setRequestEntity(new RequestEntity(){
      public boolean isRepeatable(){
        return true;
      }
      public void writeRequest(      OutputStream out) throws IOException {
        InputStream in=null;
        try {
          in=new FileInputStream(xmlFile);
          IOUtils.copy(in,out);
          out.flush();
        }
  finally {
          IOUtils.closeQuietly(in);
        }
      }
      public long getContentLength(){
switch (length) {
case -1:
          return -1;
case 0:
        return (new File(xmlFile)).length();
default :
      return length;
  }
}
public String getContentType(){
  return "text/xml";
}
}
);
}
 else {
postedBody.append(getXmlData());
post.setRequestEntity(new RequestEntity(){
public boolean isRepeatable(){
  return true;
}
public void writeRequest(OutputStream out) throws IOException {
  IOUtils.write(getXmlData(),out,"utf-8");
  out.flush();
}
public long getContentLength(){
  return getXmlData().getBytes().length;
}
public String getContentType(){
  return "text/xml; charset=utf-8";
}
}
);
}
return postedBody.toString();
}
