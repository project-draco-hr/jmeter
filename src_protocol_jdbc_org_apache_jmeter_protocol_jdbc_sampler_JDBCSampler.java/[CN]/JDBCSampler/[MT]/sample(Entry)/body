{
  log.debug("sampling jdbc");
  SampleResult res=new SampleResult();
  res.setSampleLabel(getName());
  res.setSamplerData(toString());
  res.setDataType(SampleResult.TEXT);
  res.setDataEncoding(System.getProperty("file.encoding"));
  res.setSuccessful(true);
  res.sampleStart();
  DataSourceComponent pool=(DataSourceComponent)getThreadContext().getVariables().getObject(getDataSource());
  log.debug("DataSourceComponent: " + pool);
  Connection conn=null;
  Statement stmt=null;
  try {
    if (pool == null)     throw new SQLException("No pool created");
    conn=pool.getConnection();
    String _queryType=getQueryType();
    if (SELECT.equals(_queryType)) {
      stmt=conn.createStatement();
      ResultSet rs=null;
      try {
        rs=stmt.executeQuery(getQuery());
        Data data=getDataFromResultSet(rs);
        res.setResponseData(data.toString().getBytes());
      }
  finally {
        close(rs);
      }
    }
 else     if (CALLABLE.equals(_queryType)) {
      CallableStatement cstmt=getCallableStatement(conn);
      setArguments(cstmt);
      boolean hasResultSet=cstmt.execute();
      String sb=resultSetsToString(cstmt,hasResultSet);
      res.setResponseData(sb.toString().getBytes());
    }
 else     if (UPDATE.equals(_queryType)) {
      stmt=conn.createStatement();
      stmt.executeUpdate(getQuery());
      int updateCount=stmt.getUpdateCount();
      String results=updateCount + " updates";
      res.setResponseData(results.getBytes());
    }
 else     if (PREPARED_SELECT.equals(_queryType)) {
      PreparedStatement pstmt=getPreparedStatement(conn);
      setArguments(pstmt);
      pstmt.executeQuery();
      String sb=resultSetsToString(pstmt,true);
      res.setResponseData(sb.toString().getBytes());
    }
 else     if (PREPARED_UPDATE.equals(_queryType)) {
      PreparedStatement pstmt=getPreparedStatement(conn);
      setArguments(pstmt);
      pstmt.executeUpdate();
      String sb=resultSetsToString(pstmt,false);
      res.setResponseData(sb.toString().getBytes());
    }
 else     if (ROLLBACK.equals(_queryType)) {
      conn.rollback();
      res.setResponseData(ROLLBACK.getBytes());
    }
 else     if (COMMIT.equals(_queryType)) {
      conn.commit();
      res.setResponseData(COMMIT.getBytes());
    }
 else     if (AUTOCOMMIT_FALSE.equals(_queryType)) {
      conn.setAutoCommit(false);
      res.setResponseData(AUTOCOMMIT_FALSE.getBytes());
    }
 else     if (AUTOCOMMIT_TRUE.equals(_queryType)) {
      conn.setAutoCommit(true);
      res.setResponseData(AUTOCOMMIT_TRUE.getBytes());
    }
 else {
      String results="Unexpected query type: " + _queryType;
      res.setResponseMessage(results);
      res.setSuccessful(false);
    }
  }
 catch (  SQLException ex) {
    log.error("Error in JDBC sampling",ex);
    res.setResponseMessage(ex.toString());
    res.setSuccessful(false);
  }
 finally {
    close(stmt);
    close(conn);
  }
  res.sampleEnd();
  return res;
}
