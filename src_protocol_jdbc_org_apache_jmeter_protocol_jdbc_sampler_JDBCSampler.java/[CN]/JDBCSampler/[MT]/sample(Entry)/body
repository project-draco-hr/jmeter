{
  log.debug("sampling jdbc");
  SampleResult res=new SampleResult();
  res.setSampleLabel(getName());
  res.setSamplerData(toString());
  res.sampleStart();
  DataSourceComponent pool=(DataSourceComponent)getThreadContext().getVariables().getObject(getDataSource());
  log.debug("DataSourceComponent: " + pool);
  Connection conn=null;
  Statement stmt=null;
  try {
    if (pool == null)     throw new SQLException("No pool created");
    conn=pool.getConnection();
    stmt=conn.createStatement();
    if (SELECT.equals(getQueryType())) {
      ResultSet rs=null;
      try {
        rs=stmt.executeQuery(getQuery());
        Data data=getDataFromResultSet(rs);
        res.setResponseData(data.toString().getBytes());
      }
  finally {
        if (rs != null) {
          try {
            rs.close();
          }
 catch (          SQLException exc) {
            log.warn("Error closing ResultSet",exc);
          }
        }
      }
    }
 else {
      stmt.execute(getQuery());
      int updateCount=stmt.getUpdateCount();
      String results=updateCount + " updates";
      res.setResponseData(results.getBytes());
    }
    res.setDataType(SampleResult.TEXT);
    res.setDataEncoding(System.getProperty("file.encoding"));
    res.setSuccessful(true);
  }
 catch (  SQLException ex) {
    log.error("Error in JDBC sampling",ex);
    res.setResponseMessage(ex.toString());
    res.setSuccessful(false);
  }
 finally {
    if (stmt != null) {
      try {
        stmt.close();
      }
 catch (      SQLException ex) {
        log.warn("Error closing statement",ex);
      }
    }
    if (conn != null) {
      try {
        conn.close();
      }
 catch (      SQLException ex) {
        log.warn("Error closing connection",ex);
      }
    }
  }
  res.sampleEnd();
  return res;
}
