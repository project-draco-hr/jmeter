{
  DBKey key=getKey();
  SampleResult res=new SampleResult();
  Connection conn=null;
  Statement stmt=null;
  res.setSampleLabel(getName());
  res.setSamplerData(this.toString());
  long startTime=System.currentTimeMillis();
  try {
    conn=manager.getConnection(key);
    stmt=conn.createStatement();
    if (stmt.execute(getQuery())) {
      ResultSet rs=null;
      try {
        rs=stmt.getResultSet();
        Data data=getDataFromResultSet(rs);
        res.setResponseData(data.toString().getBytes());
      }
  finally {
        if (rs != null) {
          try {
            rs.close();
          }
 catch (          SQLException exc) {
            log.warn("Error closing ResultSet",exc);
          }
        }
      }
    }
 else {
      int updateCount=stmt.getUpdateCount();
      String results=updateCount + " updates";
      res.setResponseData(results.getBytes());
    }
    res.setDataType(SampleResult.TEXT);
    res.setSuccessful(true);
  }
 catch (  Exception ex) {
    log.error("Error in JDBC sampling",ex);
    res.setResponseData(new byte[0]);
    res.setSuccessful(false);
  }
 finally {
    if (stmt != null) {
      try {
        stmt.close();
      }
 catch (      SQLException err) {
        stmt=null;
      }
    }
    if (conn != null) {
      manager.releaseConnection(key,conn);
    }
  }
  res.setTime(System.currentTimeMillis() - startTime);
  return res;
}
