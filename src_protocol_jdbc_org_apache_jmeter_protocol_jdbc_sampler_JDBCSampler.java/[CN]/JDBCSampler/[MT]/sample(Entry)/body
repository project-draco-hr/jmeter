{
  log.debug("sampling jdbc");
  SampleResult res=new SampleResult();
  res.setSampleLabel(getName());
  res.setSamplerData(toString());
  res.sampleStart();
  DataSourceComponent pool=(DataSourceComponent)getThreadContext().getVariables().getObject(getDataSource());
  log.debug("DataSourceComponent: " + pool);
  Connection conn=null;
  Statement stmt=null;
  try {
    conn=pool.getConnection();
    stmt=conn.createStatement();
    if (stmt.execute(getQuery())) {
      ResultSet rs=null;
      try {
        rs=stmt.getResultSet();
        Data data=getDataFromResultSet(rs);
        res.setResponseData(data.toString().getBytes());
      }
  finally {
        if (rs != null) {
          try {
            rs.close();
          }
 catch (          SQLException exc) {
            log.warn("Error closing ResultSet",exc);
          }
        }
      }
    }
 else {
      int updateCount=stmt.getUpdateCount();
      String results=updateCount + " updates";
      res.setResponseData(results.getBytes());
    }
    res.setDataType(SampleResult.TEXT);
    res.setSuccessful(true);
  }
 catch (  Exception ex) {
    log.error("Error in JDBC sampling",ex);
    res.setResponseData(ex.toString().getBytes());
    res.setSuccessful(false);
  }
 finally {
    if (stmt != null) {
      try {
        stmt.close();
      }
 catch (      SQLException err) {
        log.error("Error in JDBC sampling",err);
        res.setResponseData(err.toString().getBytes());
        res.setSuccessful(false);
      }
    }
    if (conn != null) {
      try {
        conn.close();
      }
 catch (      SQLException e1) {
        log.error("Error in JDBC sampling",e1);
        res.setResponseData(e1.toString().getBytes());
        res.setSuccessful(false);
      }
    }
  }
  res.sampleEnd();
  return res;
}
