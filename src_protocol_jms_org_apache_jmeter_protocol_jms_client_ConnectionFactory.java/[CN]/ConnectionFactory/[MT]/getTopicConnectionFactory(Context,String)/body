{
  int counter=MAX_RETRY;
  while (factory == null && counter > 0) {
    try {
      Object objfac=ctx.lookup(factoryName);
      if (objfac instanceof TopicConnectionFactory) {
        factory=(TopicConnectionFactory)objfac;
      }
 else {
        log.error("Expected TopicConnectionFactory, found " + objfac.getClass().getName());
        break;
      }
    }
 catch (    NamingException e) {
      if (counter == MAX_RETRY) {
        log.error("Unable to find topic connection factory " + factoryName + ", will retry. Error: "+ e.toString());
      }
 else       if (counter == 1) {
        log.error("Unable to find topic connection factory " + factoryName + ", giving up. Error: "+ e.toString());
      }
      counter--;
      try {
        Thread.sleep(PAUSE_MILLIS);
      }
 catch (      InterruptedException ie) {
      }
    }
  }
  return factory;
}
