{
  int counter=MAX_RETRY;
  while (factory == null && counter > 0) {
    try {
      Object objfac=ctx.lookup(fac);
      if (objfac instanceof TopicConnectionFactory) {
        factory=(TopicConnectionFactory)objfac;
      }
    }
 catch (    NamingException e) {
      if (counter == MAX_RETRY) {
        log.error("Unable to find connection factory " + fac + ", will retry. Error: "+ e.toString());
      }
 else       if (counter == 1) {
        log.error("Unable to find connection factory " + fac + ", giving up. Error: "+ e.toString());
      }
      counter--;
      try {
        Thread.sleep(PAUSE_MILLIS);
      }
 catch (      InterruptedException ie) {
      }
    }
  }
  return factory;
}
