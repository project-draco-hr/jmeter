{
  SampleResult result=new SampleResult();
  result.setSampleLabel(getName());
  result.setSuccessful(false);
  result.setResponseCode("000");
  result.setResponseMessage("See log file for details");
  if (publisher == null) {
    initClient();
  }
  StringBuilder buffer=new StringBuilder();
  int loop=getIterationCount();
  result.sampleStart();
  try {
    if (publisher != null && publisher.isValid) {
      for (int idx=0; idx < loop; idx++) {
        String tmsg=getMessageContent();
        publisher.publish(tmsg);
        buffer.append(tmsg);
      }
      result.sampleEnd();
      result.setResponseCodeOK();
      result.setResponseMessage(loop + " messages published");
      result.setSuccessful(true);
      result.setSamplerData(buffer.toString());
      result.setSampleCount(loop);
    }
  }
 catch (  Exception e) {
    result.sampleEnd();
    result.setResponseMessage(e.toString());
  }
  return result;
}
