{
  active=true;
  Message reply;
  while (active) {
    reply=null;
    try {
      reply=consumer.receive(5000);
      if (reply != null) {
        final String jmsCorrelationID=reply.getJMSCorrelationID();
        if (jmsCorrelationID == null) {
          log.warn("Received message with correlation id null. Discarding message ...");
        }
 else {
          if (log.isDebugEnabled()) {
            log.debug("Received message, correlation id:" + jmsCorrelationID);
          }
          MessageAdmin.getAdmin().putReply(reply.getJMSCorrelationID(),reply);
        }
      }
    }
 catch (    JMSException e1) {
      log.error("Error handling receive",e1);
    }
  }
  if (consumer != null) {
    try {
      consumer.close();
    }
 catch (    JMSException e) {
      log.error("Error closing connection",e);
    }
  }
  try {
    session.close();
  }
 catch (  JMSException e) {
    log.error("Error closing session",e);
  }
  try {
    conn.close();
  }
 catch (  JMSException e) {
    log.error("Error closing connection",e);
  }
}
