{
  SampleResult result=new SampleResult();
  result.setDataType(SampleResult.TEXT);
  StringBuffer buffer=new StringBuffer();
  StringBuffer propBuffer=new StringBuffer();
  int cnt;
  result.setSampleLabel(getName());
  initListenerClient();
  int loop=this.getIterationCount();
  result.sampleStart();
  while (queue.size() < loop && interrupted == false) {
    try {
      Thread.sleep(0,50);
    }
 catch (    InterruptedException e) {
      log.debug(e.getMessage());
    }
  }
  result.sampleEnd();
  int read=0;
  for (cnt=0; cnt < loop; cnt++) {
    TextMessage msg=queue.poll();
    if (msg != null) {
      read++;
      try {
        buffer.append(msg.getText());
        Enumeration<?> props=msg.getPropertyNames();
        while (props.hasMoreElements()) {
          String name=(String)props.nextElement();
          propBuffer.append("PROPERTY: ");
          propBuffer.append(name);
          propBuffer.append("=");
          propBuffer.append(msg.getObjectProperty(name));
          propBuffer.append("\n");
        }
      }
 catch (      JMSException e) {
        log.error(e.getMessage());
      }
    }
  }
  if (this.getReadResponseAsBoolean()) {
    result.setResponseData(buffer.toString().getBytes());
  }
 else {
    result.setBytes(buffer.toString().getBytes().length);
  }
  result.setResponseHeaders(propBuffer.toString());
  result.setDataType(SampleResult.TEXT);
  result.setSuccessful(true);
  result.setResponseCodeOK();
  result.setResponseMessage(read + " messages received");
  result.setSamplerData(loop + " messages expected");
  result.setSampleCount(read);
  return result;
}
