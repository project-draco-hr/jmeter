{
synchronized (allSockets) {
    Iterator i=allSockets.iterator();
    while (i.hasNext()) {
      Socket socket=(Socket)i.next();
      try {
        socket.close();
      }
 catch (      IOException e) {
        log.warn("Error closing socket ",e);
      }
 finally {
        i.remove();
      }
    }
  }
}
