{
  Map<String,Object> cp=tp.get();
  Socket con=null;
  if (isReUseConnection()) {
    con=(Socket)cp.get(TCPKEY);
    if (con != null) {
      log.debug(this + " Reusing connection " + con);
      return con;
    }
  }
  try {
    closeSocket();
    SocketAddress sockaddr=new InetSocketAddress(getServer(),getPort());
    con=new Socket();
    con.connect(sockaddr,getConnectTimeout());
    con.setSoTimeout(getTimeout());
    con.setTcpNoDelay(getNoDelay());
    log.debug(this + "  Timeout " + getTimeout()+ " NoDelay "+ getNoDelay());
    log.debug("Created new connection " + con);
    cp.put(TCPKEY,con);
  }
 catch (  UnknownHostException e) {
    log.warn("Unknown host for " + getLabel(),e);
    cp.put(ERRKEY,e.toString());
  }
catch (  IOException e) {
    log.warn("Could not create socket for " + getLabel(),e);
    cp.put(ERRKEY,e.toString());
  }
  return con;
}
