{
  if (hashKey == null) {
    hostName=getServer();
    portNumber=getPort();
    hashKey=hostName + ":" + portNumber;
    log.debug("Initialising socket " + hashKey);
  }
  Map cp=(Map)tp.get();
  Socket con=(Socket)cp.get(hashKey);
  if (con != null) {
    log.debug(this + " Reusing connection " + con);
    return con;
  }
  try {
    con=new Socket(hostName,portNumber);
    con.setSoTimeout(getTimeout());
    con.setTcpNoDelay(getNoDelay());
    log.debug(this + "  Timeout " + getTimeout()+ " NoDelay "+ getNoDelay());
    log.debug("Created new connection " + con);
    cp.put(hashKey,con);
  }
 catch (  UnknownHostException e) {
    log.warn("Unknown host for " + getLabel(),e);
    except=e;
  }
catch (  IOException e) {
    log.warn("Could not create socket for " + getLabel(),e);
    except=e;
  }
  return con;
}
