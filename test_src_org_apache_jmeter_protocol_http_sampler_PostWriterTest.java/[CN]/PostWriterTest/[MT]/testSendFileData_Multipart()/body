{
  String fileField="upload";
  String mimeType="text/plain";
  File file=temporaryFile;
  byte[] fileContent=TEST_FILE_CONTENT;
  setupFilepart(sampler,fileField,file,mimeType);
  String contentEncoding="";
  sampler.setContentEncoding(contentEncoding);
  postWriter.setHeaders(connection,sampler);
  postWriter.sendPostData(connection,sampler);
  checkContentTypeMultipart(connection,PostWriter.BOUNDARY);
  byte[] expectedFormBody=createExpectedFilepartOutput(PostWriter.BOUNDARY,fileField,file,mimeType,fileContent,true,true);
  checkContentLength(connection,expectedFormBody.length);
  checkArraysHaveSameContent(expectedFormBody,connection.getOutputStreamContent());
  connection.disconnect();
  establishConnection();
  contentEncoding="ISO-8859-1";
  sampler.setContentEncoding(contentEncoding);
  postWriter.setHeaders(connection,sampler);
  postWriter.sendPostData(connection,sampler);
  checkContentTypeMultipart(connection,PostWriter.BOUNDARY);
  expectedFormBody=createExpectedFilepartOutput(PostWriter.BOUNDARY,fileField,file,mimeType,fileContent,true,true);
  checkContentLength(connection,expectedFormBody.length);
  checkArraysHaveSameContent(expectedFormBody,connection.getOutputStreamContent());
  connection.disconnect();
  establishConnection();
  fileField="some_file_field";
  mimeType="image/png";
  contentEncoding="UTF-8";
  sampler.setContentEncoding(contentEncoding);
  setupFilepart(sampler,fileField,file,mimeType);
  postWriter.setHeaders(connection,sampler);
  postWriter.sendPostData(connection,sampler);
  checkContentTypeMultipart(connection,PostWriter.BOUNDARY);
  expectedFormBody=createExpectedFilepartOutput(PostWriter.BOUNDARY,fileField,file,mimeType,fileContent,true,true);
  checkContentLength(connection,expectedFormBody.length);
  checkArraysHaveSameContent(expectedFormBody,connection.getOutputStreamContent());
  connection.disconnect();
}
