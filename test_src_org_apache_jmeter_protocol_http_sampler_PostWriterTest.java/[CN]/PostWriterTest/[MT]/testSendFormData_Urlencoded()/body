{
  String titleValue="mytitle";
  String descriptionValue="mydescription";
  setupFormData(sampler,titleValue,descriptionValue);
  String contentEncoding="";
  sampler.setContentEncoding(contentEncoding);
  postWriter.setHeaders(connection,sampler);
  postWriter.sendPostData(connection,sampler);
  checkContentTypeUrlEncoded(connection);
  byte[] expectedUrl=("title=" + titleValue + "&description="+ descriptionValue).getBytes("US-ASCII");
  checkContentLength(connection,expectedUrl.length);
  checkArraysHaveSameContent(expectedUrl,connection.getOutputStreamContent());
  assertEquals(URLDecoder.decode(new String(expectedUrl,"US-ASCII"),"ISO-8859-1"),URLDecoder.decode(new String(connection.getOutputStreamContent(),"US-ASCII"),"ISO-8859-1"));
  connection.disconnect();
  establishConnection();
  contentEncoding="ISO-8859-1";
  sampler.setContentEncoding(contentEncoding);
  postWriter.setHeaders(connection,sampler);
  postWriter.sendPostData(connection,sampler);
  checkContentTypeUrlEncoded(connection);
  expectedUrl=new String("title=" + titleValue + "&description="+ descriptionValue).getBytes("US-ASCII");
  checkContentLength(connection,expectedUrl.length);
  checkArraysHaveSameContent(expectedUrl,connection.getOutputStreamContent());
  assertEquals(URLDecoder.decode(new String(expectedUrl,"US-ASCII"),contentEncoding),URLDecoder.decode(new String(connection.getOutputStreamContent(),"US-ASCII"),contentEncoding));
  connection.disconnect();
  establishConnection();
  titleValue="mytitle+123 456&yes";
  descriptionValue="mydescription and some spaces";
  contentEncoding="ISO-8859-1";
  sampler.setContentEncoding(contentEncoding);
  setupFormData(sampler,titleValue,descriptionValue);
  postWriter.setHeaders(connection,sampler);
  postWriter.sendPostData(connection,sampler);
  checkContentTypeUrlEncoded(connection);
  String expectedString="title=" + URLEncoder.encode(titleValue,contentEncoding) + "&description="+ URLEncoder.encode(descriptionValue,contentEncoding);
  expectedUrl=expectedString.getBytes(contentEncoding);
  checkContentLength(connection,expectedUrl.length);
  checkArraysHaveSameContent(expectedUrl,connection.getOutputStreamContent());
  assertEquals(URLDecoder.decode(new String(expectedUrl,"US-ASCII"),contentEncoding),URLDecoder.decode(new String(connection.getOutputStreamContent(),"US-ASCII"),contentEncoding));
  String unencodedString="title=" + titleValue + "&description="+ descriptionValue;
  byte[] unexpectedUrl=unencodedString.getBytes(UTF_8);
  checkArraysHaveDifferentContent(unexpectedUrl,connection.getOutputStreamContent());
  connection.disconnect();
  establishConnection();
  titleValue="mytitle\u0153\u20a1\u0115\u00c5";
  descriptionValue="mydescription\u0153\u20a1\u0115\u00c5";
  contentEncoding=UTF_8;
  sampler.setContentEncoding(contentEncoding);
  setupFormData(sampler,titleValue,descriptionValue);
  postWriter.setHeaders(connection,sampler);
  postWriter.sendPostData(connection,sampler);
  checkContentTypeUrlEncoded(connection);
  expectedString="title=" + URLEncoder.encode(titleValue,contentEncoding) + "&description="+ URLEncoder.encode(descriptionValue,contentEncoding);
  expectedUrl=expectedString.getBytes("US-ASCII");
  checkContentLength(connection,expectedUrl.length);
  checkArraysHaveSameContent(expectedUrl,connection.getOutputStreamContent());
  assertEquals(URLDecoder.decode(new String(expectedUrl,"US-ASCII"),contentEncoding),URLDecoder.decode(new String(connection.getOutputStreamContent(),"US-ASCII"),contentEncoding));
  connection.disconnect();
  establishConnection();
  titleValue="mytitle\u0153+\u20a1 \u0115&yes\u00c5";
  descriptionValue="mydescription \u0153 \u20a1 \u0115 \u00c5";
  contentEncoding=UTF_8;
  sampler.setContentEncoding(contentEncoding);
  setupFormData(sampler,titleValue,descriptionValue);
  postWriter.setHeaders(connection,sampler);
  postWriter.sendPostData(connection,sampler);
  checkContentTypeUrlEncoded(connection);
  expectedString="title=" + URLEncoder.encode(titleValue,UTF_8) + "&description="+ URLEncoder.encode(descriptionValue,UTF_8);
  expectedUrl=expectedString.getBytes("US-ASCII");
  checkContentLength(connection,expectedUrl.length);
  checkArraysHaveSameContent(expectedUrl,connection.getOutputStreamContent());
  assertEquals(URLDecoder.decode(new String(expectedUrl,"US-ASCII"),contentEncoding),URLDecoder.decode(new String(connection.getOutputStreamContent(),"US-ASCII"),contentEncoding));
  unencodedString="title=" + titleValue + "&description="+ descriptionValue;
  unexpectedUrl=unencodedString.getBytes("US-ASCII");
  checkArraysHaveDifferentContent(unexpectedUrl,connection.getOutputStreamContent());
  connection.disconnect();
  titleValue="mytitle%20and%20space%2Ftest%C3%85";
  descriptionValue="mydescription+and+plus+as+space%2Ftest%C3%85";
  setupFormData(sampler,true,titleValue,descriptionValue);
  establishConnection();
  contentEncoding="";
  sampler.setContentEncoding(contentEncoding);
  postWriter.setHeaders(connection,sampler);
  postWriter.sendPostData(connection,sampler);
  checkContentTypeUrlEncoded(connection);
  expectedUrl=new String("title=" + titleValue.replaceAll("%20","+").replaceAll("%C3%85","%C5") + "&description="+ descriptionValue.replaceAll("%C3%85","%C5")).getBytes("US-ASCII");
  checkContentLength(connection,expectedUrl.length);
  checkArraysHaveSameContent(expectedUrl,connection.getOutputStreamContent());
  assertEquals(URLDecoder.decode(new String(expectedUrl,"US-ASCII"),"ISO-8859-1"),URLDecoder.decode(new String(connection.getOutputStreamContent(),"US-ASCII"),"ISO-8859-1"));
  connection.disconnect();
  establishConnection();
  contentEncoding="ISO-8859-1";
  sampler.setContentEncoding(contentEncoding);
  postWriter.setHeaders(connection,sampler);
  postWriter.sendPostData(connection,sampler);
  checkContentTypeUrlEncoded(connection);
  StringBuilder sb=new StringBuilder();
  expectedUrl=(sb.append("title=").append(titleValue.replaceAll("%20","+").replaceAll("%C3%85","%C5")).append("&description=").append(descriptionValue.replaceAll("%C3%85","%C5"))).toString().getBytes("US-ASCII");
  checkContentLength(connection,expectedUrl.length);
  checkArraysHaveSameContent(expectedUrl,connection.getOutputStreamContent());
  assertEquals(URLDecoder.decode(new String(expectedUrl,"US-ASCII"),contentEncoding),URLDecoder.decode(new String(connection.getOutputStreamContent(),"US-ASCII"),contentEncoding));
  connection.disconnect();
  establishConnection();
  contentEncoding=UTF_8;
  sampler.setContentEncoding(contentEncoding);
  postWriter.setHeaders(connection,sampler);
  postWriter.sendPostData(connection,sampler);
  checkContentTypeUrlEncoded(connection);
  expectedUrl=("title=" + titleValue.replaceAll("%20","+") + "&description="+ descriptionValue).getBytes("US-ASCII");
  checkContentLength(connection,expectedUrl.length);
  checkArraysHaveSameContent(expectedUrl,connection.getOutputStreamContent());
  assertEquals(URLDecoder.decode(new String(expectedUrl,"US-ASCII"),contentEncoding),URLDecoder.decode(new String(connection.getOutputStreamContent(),"US-ASCII"),contentEncoding));
  connection.disconnect();
}
