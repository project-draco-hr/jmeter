{
  final byte[] DASH_DASH=new String("--").getBytes(HTTP_ENCODING);
  final ByteArrayOutputStream output=new ByteArrayOutputStream();
  if (firstMultipart) {
    output.write(DASH_DASH);
    output.write(boundaryString.getBytes(HTTP_ENCODING));
    output.write(CRLF);
  }
  String filename=file.getName();
  output.write("Content-Disposition: form-data; name=\"".getBytes(HTTP_ENCODING));
  output.write(fileField.getBytes(HTTP_ENCODING));
  output.write(("\"; filename=\"" + filename + "\"").getBytes(HTTP_ENCODING));
  output.write(CRLF);
  output.write("Content-Type: ".getBytes(HTTP_ENCODING));
  output.write(mimeType.getBytes(HTTP_ENCODING));
  output.write(CRLF);
  output.write("Content-Transfer-Encoding: binary".getBytes(HTTP_ENCODING));
  output.write(CRLF);
  output.write(CRLF);
  output.write(fileContent);
  output.write(CRLF);
  output.write(DASH_DASH);
  output.write(boundaryString.getBytes(HTTP_ENCODING));
  if (lastMultipart) {
    output.write(DASH_DASH);
  }
  output.write(CRLF);
  output.flush();
  output.close();
  return output.toByteArray();
}
